(function(g){var window=this;'use strict';var K6H=function(Q){var W=new g.KN("und",new g.wr("Default","und",!0));W.captionTracks=Q.captionTracks;return W},lFA=function(Q){return new g.Xk(function(W,x){var D=Q.length,K=[];
if(D)for(var l=function(b,z){D--;K[b]=z;D==0&&W(K)},M=function(b){x(b)},w,S=0;S<Q.length;S++)w=Q[S],g.tE2(w,g.tv(l,S),M);
else W(K)})},Bw=function(Q){this.B=Q},$x=function(){Bw.apply(this,arguments)},jHe=function(){$x.apply(this,arguments)},Mrk=function(){$x.apply(this,arguments)},R_Y=function(){$x.apply(this,arguments)},w0R=function(){$x.apply(this,arguments)},S1Y=function(){$x.apply(this,arguments)},b45=function(){$x.apply(this,arguments)},sHH=function(){Bw.apply(this,arguments)},z_5=function(){$x.apply(this,arguments)},kYA=function(){$x.apply(this,arguments)},X05=function(){$x.apply(this,arguments)},ols=function(){$x.apply(this,
arguments)},uA5=function(){$x.apply(this,arguments)},Y1p=function(){$x.apply(this,arguments)},nl7=function(){$x.apply(this,arguments)},VrJ=function(){$x.apply(this,arguments)},PTC=function(){$x.apply(this,arguments)},vl1=function(){$x.apply(this,arguments)},CTs=function(){$x.apply(this,arguments)},JFu=function(){$x.apply(this,arguments)},p0R=function(){Bw.apply(this,arguments)},h_C=function(){$x.apply(this,arguments)},aFR=function(){$x.apply(this,arguments)},GY7=function(){$x.apply(this,arguments)},
dM5=function(){$x.apply(this,arguments)},i4p=function(){$x.apply(this,arguments)},AFu=function(){$x.apply(this,arguments)},H45=function(){$x.apply(this,arguments)},UMs=function(){$x.apply(this,arguments)},q1p=function(){$x.apply(this,arguments)},BB5=function(){Bw.apply(this,arguments)},$MR=function(){Bw.apply(this,arguments)},IFs=function(){Bw.apply(this,arguments)},mMe=function(){$x.apply(this,arguments)},NBH=function(){$x.apply(this,arguments)},cFu=function(){$x.apply(this,arguments)},glH=function(){$x.apply(this,
arguments)},yFu=function(){$x.apply(this,arguments)},e_s=function(){$x.apply(this,arguments)},fFk=function(){$x.apply(this,arguments)},Z4C=function(){$x.apply(this,arguments)},L6Y=function(){$x.apply(this,arguments)},rF5=function(){$x.apply(this,arguments)},TBC=function(){$x.apply(this,arguments)},O4q=function(){$x.apply(this,arguments)},Ele=function(){$x.apply(this,arguments)},F6H=function(){$x.apply(this,arguments)},trq=function(){$x.apply(this,arguments)},QXJ=function(){$x.apply(this,arguments)},
Wns=function(){$x.apply(this,arguments)},x2s=function(){$x.apply(this,arguments)},D2u=function(){$x.apply(this,arguments)},Kn5=function(){$x.apply(this,arguments)},lmp=function(){$x.apply(this,arguments)},jXq=function(){$x.apply(this,arguments)},Muq=function(){$x.apply(this,arguments)},RJq=function(){$x.apply(this,arguments)},wCe=function(){$x.apply(this,arguments)},SWH=function(){$x.apply(this,arguments)},bmH=function(){Bw.apply(this,arguments)},sXs=function(){$x.apply(this,arguments)},zJR=function(){$x.apply(this,
arguments)},kks=function(){$x.apply(this,arguments)},XCJ=function(){$x.apply(this,arguments)},oGs=function(){$x.apply(this,arguments)},unp=function(){$x.apply(this,arguments)},YWq=function(){$x.apply(this,arguments)},nGJ=function(){$x.apply(this,arguments)},VuR=function(){$x.apply(this,arguments)},PRR=function(){$x.apply(this,arguments)},vGp=function(){$x.apply(this,arguments)},CRe=function(){$x.apply(this,arguments)},J8A=function(){$x.apply(this,arguments)},pCR=function(){$x.apply(this,arguments)},
hJ5=function(){$x.apply(this,arguments)},am1=function(){$x.apply(this,arguments)},Gkk=function(){$x.apply(this,arguments)},d2H=function(){$x.apply(this,arguments)},im1=function(){$x.apply(this,arguments)},A8p=function(){$x.apply(this,arguments)},HmJ=function(){$x.apply(this,arguments)},U2k=function(){$x.apply(this,arguments)},qWp=function(){$x.apply(this,arguments)},BuA=function(){$x.apply(this,arguments)},$2e=function(){$x.apply(this,arguments)},Imk=function(){$x.apply(this,arguments)},m2k=function(){$x.apply(this,
arguments)},Nuq=function(){$x.apply(this,arguments)},c8J=function(){$x.apply(this,arguments)},gG1=function(){$x.apply(this,arguments)},y8s=function(Q){Q=Q.key||Q.id;
if(!Q)throw Error("Entity key is missing");return Q},eJH=function(){if(In)return In();
var Q={};In=g.QV("PersistentEntityStoreDb",{mZ:(Q.EntityStore={yd:1},Q.EntityAssociationStore={yd:2},Q),shared:!1,upgrade:function(W,x){x(1)&&g.Bs(g.dV(W,"EntityStore",{keyPath:"key"}),"entityType","entityType");x(2)&&(W=g.dV(W,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.Bs(W,"byParentEntityKey","parentEntityKey"),g.Bs(W,"byChildEntityKey","childEntityKey"))},
version:3});return In()},fmC=function(Q){return g.eM(eJH(),Q)},ZmH=function(Q){return g.eM((0,g.I31)(),Q)},m8=function(Q){this.token=Q},NX=function(Q,W){W=W===void 0?{}:W;
g.Lw.call(this,g.map[Q],Object.assign({},{name:"PESEncoderError",type:Q},W));this.type=Q;this.level="WARNING";Object.setPrototypeOf(this,NX.prototype)},Lnk=function(Q){return new NX("WRONG_DATA_TYPE",{z0:Q})},r85=function(Q){return Q instanceof Error?new NX("UNKNOWN_ENCODE_ERROR",{JZ:Q.message}):new NX("UNKNOWN_ENCODE_ERROR")},Tu7=function(Q){return Q instanceof Error?new NX("UNKNOWN_DECODE_ERROR",{JZ:Q.message}):new NX("UNKNOWN_DECODE_ERROR")},OmF=function(Q,W){Q=Q instanceof NX?Q:W(Q);
g.ql(Q);throw Q;},EGq=function(){},Fnu=function(Q,W,x){try{return Q.D(W,x)}catch(D){OmF(D,r85)}},tu7=function(Q){Q=(new TextEncoder).encode(Q).subarray(0,16);
var W=new Uint8Array(16);W.set(Q);return W},cw=function(Q){this.B=Q},WfJ=function(Q){var W=QB1[Q];
if(W)return W;g.Bp(new g.Lw("Entity model not found.",{entityType:Q}))},xIu=function(Q,W){this.B=Q;
this.U=W;this.D={}},KfY=function(Q,W){a:{Q=DI7(Q.U,W.version);
try{var x=Q.U(W.data,W.key);break a}catch(D){OmF(D,Tu7)}x=void 0}return x},gU=function(Q,W,x){return Q.B.objectStore("EntityStore").get(W).then(function(D){if(D){if(x&&D.entityType!==x)throw Error("Incorrect entity type");
return KfY(Q,D)}})},y6=function(Q,W,x){return x?(x=x.map(function(D){return gU(Q,D,W)}),g.CX.all(x)):Q.B.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(W)).then(function(D){return D.map(function(K){return KfY(Q,K)})})},fF=function(Q,W,x){var D=y8s(W),K=DI7(Q.U,1),l=Object.assign({},W);
return Q.B.objectStore("EntityStore").get(D).then(function(M){if(M){if(M.entityType!==x)throw Error("Incorrect entity type");l.entityMetadata||(M=KfY(Q,M),l.entityMetadata=M.entityMetadata)}}).then(function(){var M={key:D,
entityType:x,data:Fnu(K,l,D),version:1};return g.CX.all([g.Hs(Q.B.objectStore("EntityStore"),M),liu(Q,l,x)])}).then(function(){eK(Q,D,x);
return D})},jBe=function(Q,W,x){W=W.map(function(D){return fF(Q,D,x)});
return g.CX.all(W)},Zz=function(Q,W,x){if(x==null?0:x.xr){var D=new Set;
return MZ7(Q,W,D).then(function(){for(var l=[],M=g.V(D),w=M.next();!w.done;w=M.next())l.push(Zz(Q,w.value));return g.CX.all(l).then(function(){})})}var K=g.jd(W).entityType;
return g.CX.all([Q.B.objectStore("EntityStore").delete(W),R4k(Q,W)]).then(function(){eK(Q,W,K)})},wRY=function(Q,W){return g.N5(Q.B.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(W)},function(x){return g.CX.all([x.delete(),
R4k(Q,x.cursor.primaryKey)]).then(function(){eK(Q,x.cursor.primaryKey,W);return g.I8(x)})})},SBF=function(Q,W,x,D){var K=DI7(Q.U,1);
return gU(Q,W,D).then(function(l){if(l){l=g.ot(l,x);var M={key:W,entityType:D,data:Fnu(K,l,W),version:1};return g.CX.all([g.Hs(Q.B.objectStore("EntityStore"),M),liu(Q,l,D)])}}).then(function(){eK(Q,W,D);
return W})},eK=function(Q,W,x){var D=Q.D[x];
D||(D=new Set,Q.D[x]=D);D.add(W)},bpY=function(Q,W,x){var D=y8s(W);
x=WfJ(x);if(!x)return g.CX.resolve([]);x=new x(W);Q=Q.B.objectStore("EntityAssociationStore");W=[];x=g.V(x.U());for(var K=x.next();!K.done;K=x.next())W.push(g.Hs(Q,{parentEntityKey:D,childEntityKey:K.value}));return g.CX.all(W).then(function(l){return l.map(function(M){return M[1]})})},R4k=function(Q,W){return Q.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W))},liu=function(Q,W,x){var D=y8s(W);
return R4k(Q,D).then(function(){return bpY(Q,W,x)})},MZ7=function(Q,W,x){if(x.has(W))return g.CX.resolve(void 0);
x.add(W);return sBC(Q,W).then(function(D){return Q.B.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(W)).then(function(){return D})}).then(function(D){var K=g.CX.resolve(void 0);
D=g.V(D);for(var l=D.next(),M={};!l.done;M={DZ:void 0},l=D.next())M.DZ=l.value,K=K.then(function(w){return function(){return MZ7(Q,w.DZ,x)}}(M));
return K}).then(function(){})},sBC=function(Q,W){var x=Q.B.objectStore("EntityAssociationStore");
return x.index("byParentEntityKey").getAll(IDBKeyRange.only(W)).then(function(D){var K=[];D=g.V(D);for(var l=D.next();!l.done;l=D.next())l=l.value,K.push(x.index("byChildEntityKey").getAll(l.childEntityKey));return g.CX.all(K)}).then(function(D){var K=[];
D=g.V(D);for(var l=D.next();!l.done;l=D.next())l=l.value,l.length===1&&K.push(l[0].childEntityKey);return K})},LF=function(){},z4s=function(){this.B={};
this.B[0]=new LF;if(!g.Pb("aes_pes_encoder_killswitch")){var Q=this.B;try{var W=g.r3();var x=tu7(W);var D=new cw(new g.CB(x),new g.vE(x))}catch(K){throw Q=K instanceof Error?new NX("KEY_CREATION_FAILED",{JZ:K.message}):new NX("KEY_CREATION_FAILED"),g.ql(Q),Q;}Q[1]=D}},DI7=function(Q,W){W=W===void 0?0:W;
Q=Q.B[W];if(!Q)throw W=new NX("INVALID_ENCODER_VERSION",{z0:W}),g.ql(W),W;return Q},rU=function(Q,W){g.N.call(this);
this.token=Q;this.B=W;this.observers=[];Q=new g.Nz.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.r3());Q.onmessage=this.U.bind(this);this.channel=Q},Tc=function(Q,W,x){var D,K,l,M;
return g.U(function(w){if(w.B==1)return g.A(w,fmC(Q.token),2);if(w.B!=3)return D=w.U,g.A(w,g.A4(D,["EntityStore","EntityAssociationStore"],W,function(S){K=new xIu(S,Q.B);return x(K)}),3);
l=w.U;K&&(M=K.D,Object.keys(M).length>0&&(Q.channel.postMessage(M),kJk(Q,M)));return w.return(l)})},O8=function(Q,W,x){return Tc(Q,{mode:"readwrite",
dG:!0},function(D){return fF(D,W,x)})},XRJ=function(Q,W){return Tc(Q,{mode:"readwrite",
dG:!0},function(x){return jBe(x,W,"offlineOrchestrationActionWrapperEntity")})},ogF=function(Q,W){return Tc(Q,{mode:"readwrite",
dG:!0},function(x){return Zz(x,W)})},u9p=function(Q){return Tc(Q,{mode:"readwrite",
dG:!0},function(W){return wRY(W,"videoPlaybackPositionEntity")})},E8=function(Q,W,x){return Tc(Q,{mode:"readonly",
dG:!0},function(D){return gU(D,W,x)})},FM=function(Q,W,x){return Tc(Q,{mode:"readonly",
dG:!0},function(D){return y6(D,W,x)})},kJk=function(Q,W){Q=g.V(Q.observers);
for(var x=Q.next();!x.done;x=Q.next())x=x.value,x(W)},YBk=function(){var Q,W,x;
return g.U(function(D){if(D.B==1)return g.P5(D,2),g.A(D,g.Fi(),4);if(D.B!=2){Q=D.U;if(!Q||!g.TT()||typeof g.Nz.BroadcastChannel==="undefined")return D.return();W=new z4s;return D.return(new rU(Q,W))}x=g.Jv(D);x instanceof Error&&g.ql(x);return D.return()})},t9=function(){ngH||(ngH=YBk());
return ngH},VZe=function(Q){var W;
Q=(W=Q.options)==null?void 0:W.persistenceOption;return Q==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Q==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},PqH=function(Q){var W;
return g.U(function(x){return x.B==1?g.A(x,t9(),2):(W=x.U)?g.A(x,Tc(W,"readwrite",function(D){for(var K={},l=g.V(Q),M=l.next(),w={};!M.done;w={E8:void 0,Y9:void 0},M=l.next())w.E8=M.value,w.E8.entityKey&&VZe(w.E8)&&(w.Y9=g.CC(w.E8.payload),M=void 0,w.E8.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(M=function(S){return function(){return fF(D,S.E8.payload[S.Y9],S.Y9)}}(w)),w.E8.type==="ENTITY_MUTATION_TYPE_DELETE"&&(M=function(S){return function(){return Zz(D,S.E8.entityKey)}}(w)),w.E8.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(M=function(S){return function(){return SBF(D,S.E8.entityKey,S.E8.payload[S.Y9],S.Y9)}}(w)),M&&(K[w.E8.entityKey]=K[w.E8.entityKey]?K[w.E8.entityKey].then(M):M()));
return g.CX.all(Object.values(K))}),0):x.return()})},vgs=function(Q){var W;
return g.U(function(x){if(x.B==1){W=Q.mutations;if(!W||W.length<=0)return x.return();if(g.xN){var D={type:"ENTITY_LOADED"};W!==void 0&&(D.payload=W);g.xN.dispatch(D)}return g.A(x,PqH(W),2)}W.length=0;g.VF(x)})},CqH=function(Q){return Q!==void 0},JPY=function(Q){var W=g.d0();
W=Object.assign({},W);Q=Object.assign({},Q);for(var x in W)Q[x]?(W[x]!==4&&(W[x]=Q[x]),delete Q[x]):W[x]!==2&&(W[x]=4);Object.assign(W,Q);g.MNz(W);JSON.stringify(W);return W},pR5=function(Q){var W,x;
return g.U(function(D){if(D.B==1)return g.A(D,g.Fi(),2);if(D.B!=3)return(W=D.U)?g.A(D,g.HW(W),3):D.return();x=D.U;return D.return(g.A4(x,["index","media","captions"],{mode:"readwrite",dG:!0},function(K){var l=IDBKeyRange.bound(Q+"|",Q+"~");K=[K.objectStore("index").delete(l),K.objectStore("media").delete(l),K.objectStore("captions").delete(l)];return g.CX.all(K).then(function(){})}))})},h4A=function(){var Q,W;
return g.U(function(x){if(x.B==1)return g.A(x,g.Fi(),2);if(x.B!=3){Q=x.U;if(!Q)throw g.Ps("rvdfd");return g.A(x,g.HW(Q),3)}W=x.U;return x.return(g.A4(W,["index","media"],{mode:"readwrite",dG:!0},function(D){var K={};return g.$D(D.objectStore("index"),{},function(l){var M=l.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),w=g.CX.resolve(void 0);if(M){var S=M[1];M=M[2];K[S]=K[S]||{};var b;K[S][M]=g.sQO((b=l.getValue())==null?void 0:b.fmts)}else w=l.delete().then(function(){});
return g.CX.all([g.I8(l),w]).then(function(z){return g.V(z).next().value})}).then(function(){for(var l={},M=g.V(Object.keys(K)),w=M.next();!w.done;w=M.next()){w=w.value;
var S=K[w].v;l[w]=K[w].a&&S?1:2}var b=JPY(l);return g.gRh(D.objectStore("media"),{},function(z){var k=z.cursor.key.match(g.oO2);k&&l[k[1]]||D.objectStore("media").delete(z.cursor.key);return g.HT5(z)}).then(function(){return b})})}))})},aiY=function(Q,W){var x,D;
return g.U(function(K){if(K.B==1)return g.A(K,g.Fi(),2);if(K.B!=3){x=K.U;if(!x)throw g.Ps("wct");return g.A(K,g.HW(x),3)}D=K.U;return g.A(K,g.A4(D,["captions"],{mode:"readwrite",dG:!0},function(l){var M=[];l=l.objectStore("captions");for(var w=0;w<W.length;w++){var S=g.Hs(l,W[w],Q+"|"+W[w].metadata.vss_id);M.push(S)}return g.CX.all(M)}),0)})},GJk=function(Q){var W,x,D;
return g.U(function(K){if(K.B==1)return W=IDBKeyRange.bound(Q+"|",Q+"~"),g.A(K,g.Fi(),2);if(K.B!=3){x=K.U;if(!x)throw g.Ps("gactfv");return g.A(K,g.HW(x),3)}D=K.U;return K.return(D.getAll("captions",W))})},dIC=function(Q){return g.U(function(W){g.AQ(Q,0);
return W.return(pR5(Q))})},ip1=function(Q){return{context:g.EH(),
videoIds:Q}},APF=function(Q){return{context:g.EH(),
playlistIds:Q}},Hpe=function(Q){return{context:g.EH(),
offlinePlaylistSyncChecks:Q}},UIu=function(){this.B=new Map},BMu=function(){qBe||(qBe=new UIu);
return qBe},$IY=function(Q,W){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Q},metadata:W,statusCode:void 0,csn:void 0,can:void 0}},IiR=function(Q,W,x){if(!x){var D=D===void 0?!1:D;
x=Q.B.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!x||D)x=g.Cu(16),Q.B.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",x)}Q={flowNonce:x,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:W.eventType};W.metadata&&(Q.flowMetadata=W.metadata);W.statusCode!==void 0&&(Q.flowEventStatus=W.statusCode);W.csn&&(Q.csn=W.csn);W.can&&(Q.can=W.can);g.wV("flowEvent",Q,void 0)},mIR=function(Q){var W,x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d;
return g.U(function(q){if(q.B==1)return g.A(q,Tc(Q,{mode:"readonly",dG:!0},function(m){return y6(m,"playbackData").then(function(W5){var l2=W5.map(function(o1){return o1.transfer}).filter(function(o1){return!!o1}),jn=W5.map(function(o1){return o1.offlineVideoPolicy}).filter(function(o1){return!!o1}),B=W5.filter(function(o1){return!!o1.key}).map(function(o1){return g.Mb(g.jd(o1.key).entityId,"downloadStatusEntity")});
l2=y6(m,"transfer",l2);jn=y6(m,"offlineVideoPolicy",jn);B=y6(m,"downloadStatusEntity",B);var b2=l2.then(function(o1){o1=o1.reduce(function(w4,Av){(Av==null?0:Av.offlineVideoStreams)&&w4.push.apply(w4,g.C(Av.offlineVideoStreams));return w4},[]).filter(function(w4){return!!w4});
return y6(m,"offlineVideoStreams",o1)});
return g.CX.all([l2,jn,b2,B]).then(function(o1){var w4=g.V(o1);o1=w4.next().value;var Av=w4.next().value;var XH=w4.next().value;w4=w4.next().value;return[W5,o1,Av,XH,w4]})})}),2);
if(q.B!=3)return W=q.U,g.A(q,Tc(Q,{mode:"readonly",dG:!0},function(m){return y6(m,"mainDownloadsListEntity").then(function(W5){var l2,jn;return(jn=(l2=W5[0])==null?void 0:l2.downloads)!=null?jn:[]})}),3);
x=q.U;D=g.V(W);K=D.next().value;l=D.next().value;M=D.next().value;w=D.next().value;S=D.next().value;b=K;z=l;k=M;X=w;u=S;Y={};v={};J={};h={};G={};H=[];I=g.V(z);for(c=I.next();!c.done;c=I.next())(O=c.value)&&(Y[O.key]=O);T=g.V(k);for(Ks=T.next();!Ks.done;Ks=T.next())(Mz=Ks.value)&&(v[Mz.key]=Mz);QF=g.V(u);for(f=QF.next();!f.done;f=QF.next())(t=f.value)&&(J[t.key]=t);P=g.V(X);for(Z=P.next();!Z.done;Z=P.next())(c5=Z.value)&&(h[c5.key]=c5);vu=g.V(x);for(kF=vu.next();!kF.done;kF=vu.next())a1=kF.value,El=
void 0,G[(El=a1.videoItem)!=null?El:""]=!0,a1.videoItem&&(uC=D7=void 0,p=(uC=(D7=g.jd(a1.videoItem))==null?void 0:D7.entityId)!=null?uC:"",H.push({externalVideoId:p}));a=b.filter(function(m){if(!m||!m.key||!m.offlineVideoPolicy)return!1;m=g.jd(m.key).entityId;m=g.Mb(m,"downloadStatusEntity");var W5;return!(m&&((W5=J[m])==null?void 0:W5.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
d=a.map(function(m){var W5=Y[m.transfer],l2=[];if(W5==null?0:W5.offlineVideoStreams)for(var jn=g.V(W5.offlineVideoStreams),B=jn.next();!B.done;B=jn.next())(B=h[B.value])&&l2.push(B);jn=v[m.offlineVideoPolicy];B=G;var b2=m==null?void 0:m.playerResponseTimestamp,o1=g.jd(jn.key).entityId;m=g.Mb(o1,"mainVideoEntity");if(jn.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var w4="OFFLINE_VIDEO_STATE_DISABLED";jn.expirationTimestamp&&Number(jn.expirationTimestamp)<Date.now()/1E3&&(w4="OFFLINE_VIDEO_STATE_EXPIRED")}else if(jn.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")w4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(W5==null?void 0:W5.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":w4="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":w4="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":w4="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":w4="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":w4="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":w4="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:w4="OFFLINE_VIDEO_STATE_UNKNOWN"}if(w4==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(W5==null?void 0:W5.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":w4="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":w4="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":w4=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}o1={id:o1,videoState:w4};if(W5==null?0:W5.cotn)o1.cotn=W5.cotn;if(W5==null?0:W5.maximumDownloadQuality)o1.selectedVideoQuality=W5==null?void 0:W5.maximumDownloadQuality;if(W5==null?0:W5.lastProgressTimeMs)o1.lastProgressTimeMs=W5.lastProgressTimeMs;b2&&(o1.playerResponseSavedTimeMs=String(Number(b2)*1E3));W5=String;b2=0;l2=g.V(l2);for(w4=l2.next();!w4.done;w4=l2.next())if(w4=w4.value,w4.streamsProgress){w4=g.V(w4.streamsProgress);for(var Av=w4.next();!Av.done;Av=
w4.next()){var XH=void 0;b2+=Number((XH=Av.value.numBytesDownloaded)!=null?XH:0)}}o1.downloadedBytes=W5(b2);o1.selectedOfflineMode=B[m]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";jn.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(o1.offlinePlaybackDisabledReason=jn.offlinePlaybackDisabledReason);return o1});
return q.return({offlineVideos:d,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:H}}})})},NMp=function(){this.locks=navigator.locks},cPR=function(){try{var Q=g.yF("ytglobal.locks_");
if(Q)return Q;var W;if(W=navigator){var x=navigator;W="locks"in x&&!!x.locks}if(W)return g.Nz.localStorage&&g.Nz.localStorage.getItem("noop"),Q=new NMp,g.g4("ytglobal.locks_",Q),Q}catch(D){}},QG=function(){},gg7=function(){},yPA=function(Q){if(Q.includes(":"))throw Error("Invalid user cache name: "+Q);
return Q+":"+g.r3("CacheStorage get")},e4s=function(){return g.U(function(Q){if(Wz!==void 0)return Q.return(Wz);
Wz=new Promise(function(W){var x;return g.U(function(D){switch(D.B){case 1:return g.P5(D,2),g.A(D,xr.open("test-only"),4);case 4:return g.A(D,xr.delete("test-only"),5);case 5:g.Cs(D,3);break;case 2:if(x=g.Jv(D),x instanceof Error&&x.name==="SecurityError")return W(!1),D.return();case 3:W("caches"in window),g.VF(D)}})});
return Q.return(Wz)})},Zp5=function(){return g.U(function(Q){if(Q.B==1)return g.A(Q,e4s(),2);
if(!Q.U)return Q.return(void 0);fiC||(fiC=new gg7);return Q.return(fiC)})},Dq=function(Q,W,x){g.Bp(new g.Lw("Woffle: "+Q,x?{cotn:x}:""));
W instanceof Error&&g.Bp(W)},LfC=function(Q){var W;
return g.U(function(x){if(x.B==1)return g.A(x,mIR(Q),2);W=x.U;g.wV("offlineStateSnapshot",W);g.VF(x)})},Ke=function(Q){g.N.call(this);
var W=this;this.api=Q;this.by={vg3:function(){return W.B},
PTj:function(){return W.U}};
typeof g.Nz.BroadcastChannel!=="undefined"&&(this.B=new g.Nz.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.r3()),this.B.onmessage=this.D.bind(this),this.U=new g.Nz.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.r3()),this.U.onmessage=this.N.bind(this))},l_=function(Q,W){Q.api.Wt("onOfflineOperationFailure",W);
var x;(x=Q.B)==null||x.postMessage(W)},rPH=function(Q,W,x,D){var K=this;
this.S=Q;this.T=W;this.visibility=x;this.j=D;this.L=this.G=this.X=this.D=this.B=!1;this.N=new g.O3(function(){K.i4()});
this.by={Sp:function(){return K.U},
i4:function(){K.i4()},
ZNZ:function(){return K.N}};
this.visibility.subscribe("visibilitystatechange",function(){K.PZ()})},TMq=function(Q){if(!Q.D&&!Q.B){var W=cPR();
if(W){Q.D=!0;var x=g.r3("OfflineLockManager");W.request("woffle_orchestration_leader:"+x,{},function(){var D,K,l,M;return g.U(function(w){switch(w.B){case 1:return g.P5(w,2),Q.U=new g.XT,Q.B=!0,Q.D=!1,g.A(w,Q.S(),4);case 4:return g.A(w,Q.U.promise,5);case 5:g.Cs(w,0);break;case 2:D=g.Jv(w),((l=(K=Q).j)==null?0:l.call(K,"wo_relinquish_leadership_on_lock_request_error"))||Q.i4(),D instanceof Error&&(M=D,M.args=[{name:"WoLockManagerError",U5:D.name}],g.ql(M)),g.VF(w)}})})}}},Opk=function(Q){Q.B&&(Q.L=
!0,jR(Q))},EgR=function(Q,W){Q.B&&(Q.X=W,jR(Q))},Ffq=function(Q,W){Q.B&&(Q.G=W,jR(Q))},jR=function(Q){Q.G&&Q.X&&Q.L&&Q.visibility.isBackground()?g.E3(Q.N,6E4):Q.N.stop()},MV=function(Q){var W;
Q.offlineDeleteReason=(W=Q.offlineDeleteReason)!=null?W:"OFFLINE_DELETE_REASON_UNKNOWN";var x;Q.offlineModeType=(x=Q.offlineModeType)!=null?x:"OFFLINE_NOW";g.wV("offlineDeleteEvent",Q)},R$=function(Q,W){var x=W.videoId;
var D=W.t9;W=W.offlineModeType;Q.encryptedVideoId=x;Q.cotn=D==null?void 0:D.cotn;Q.offlineabilityFormatType=D==null?void 0:D.maximumDownloadQuality;var K;Q.isRefresh=(K=D==null?void 0:D.isRefresh)!=null?K:!1;var l;Q.softErrorCount=(l=D==null?void 0:D.transferRetryCount)!=null?l:0;Q.offlineModeType=W!=null?W:"OFFLINE_NOW";(Q.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Q.statusType==="UNKNOWN_STATUS_TYPE"||!Q.transferStatusType&&!Q.statusType)&&g.Bp(Error("Woffle unknown transfer status"));
g.wV("offlineTransferStatusChanged",Q)},tZY=function(Q,W,x,D){D={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!D};W&&x&&(W=Math.floor(W/1024).toFixed(),x=Math.floor(x/1024).toFixed(),D.alreadyDownloadedKbytes=W,D.totalFetchedKbytes=W,D.totalContentKbytes=x);R$(D,Q)},Qve=function(Q){R$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Q)},WbY=function(Q){switch(Q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
wA=function(Q){var W,x,D;
return((D=(W=Q.actionMetadata)==null?void 0:(x=W.retryScheduleIntervalsInSeconds)==null?void 0:x.length)!=null?D:0)>0},SR=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Q.entityKey},b_=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Q.entityKey},s4=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Q.entityKey},x75=function(Q){return Q.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Q.entityKey},
z9=function(Q,W,x,D,K){K=K===void 0?!1:K;
var l,M,w,S,b,z;return g.U(function(k){if(k.B==1)return l=g.Mb(Q,W),M=g.Mb(Q,"downloadStatusEntity"),g.A(k,Tc(x,{mode:"readonly",dG:!0},function(X){return g.CX.all([gU(X,l,W),gU(X,M,"downloadStatusEntity")])}),2);
w=k.U;S=w.length?w[0]:void 0;if(!S)return k.kf(0);b=D7k;if(z=w.length>1?w[1]:void 0){if(z.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!K)return k.return();z.downloadState=D}else z={key:M,downloadState:D};g.cp(S,b,z);return g.A(k,Tc(x,{mode:"readwrite",dG:!0},function(X){return g.CX.all([fF(X,S,W),fF(X,z,"downloadStatusEntity")])}),0)})},kr=function(Q,W){return Q.actionType===W.actionType&&Q.entityKey===W.entityKey},Xg=function(Q,W){if(Q&&Q.transferState!=="TRANSFER_STATE_COMPLETE"&&Q.transferState!==
"TRANSFER_STATE_FAILED"){var x=g.jd(Q.key).entityId;
R$({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:x,t9:Q,offlineModeType:W})}},o$=function(Q){if(!Q||!Q.thumbnails)return[];
var W=[];Q=g.V(Q.thumbnails);for(var x=Q.next();!x.done;x=Q.next())x=x.value,x.url&&W.push(x.url);return W},Kbs=function(Q,W,x){x=x===void 0?[]:x;
var D,K,l,M,w,S,b,z,k,X,u,Y,v;return g.U(function(J){if(J.B==1)return x.length?g.A(J,FM(Q,W),2):J.return([]);D=J.U;K=new Set;l=g.V(D);for(M=l.next();!M.done;M=l.next())if(w=M.value,S=w.id||w.key)b=g.jd(S).entityId,K.add(b);z=[];k=g.V(x);for(X=k.next();!X.done;X=k.next())u=X.value,Y=u.offlineVideoData,v=void 0,((v=Y)==null?0:v.videoId)&&!K.has(Y.videoId)&&z.push(u);return J.return(z)})},lGs=function(Q,W,x){return new g.f1(Q,{cotn:W,
raw_player_response:x,download_media:!0,start:Infinity,disable_watch_next:!0})},jvY=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},u_=function(Q,W,x,D,K,l,M,w,S,b,z){this.entityType=Q;
this.actionId=W;this.action=x;this.parentActionId=D;this.rootActionId=K===void 0?W:K;this.childActionIds=l;this.prereqActionId=M;this.postreqActionIds=w;this.hasChildActionFailed=b;this.retryScheduleIndex=0;this.B=z||Date.now();this.retryScheduleIndex=S||0},Yr=function(Q){if(!Q.key)throw Error("Entity key is required.");
if(!Q.actionProto)throw Error("OfflineOrchestrationAction is required.");var W=g.jd(Q.key),x=g.jd(Q.actionProto.entityKey);return new u_(x.entityType,W.entityId,Q.actionProto,Q.parentActionId,Q.rootActionId,Q.childActionIds,Q.prereqActionId,Q.postreqActionIds,Q.retryScheduleIndex,Q.hasChildActionFailed,Number(Q.enqueueTimeSec)*1E3)},ne=function(Q){return{key:g.Mb(Q.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Q.action,parentActionId:Q.parentActionId,rootActionId:Q.rootActionId,childActionIds:Q.childActionIds,prereqActionId:Q.prereqActionId,postreqActionIds:Q.postreqActionIds,retryScheduleIndex:Q.retryScheduleIndex,hasChildActionFailed:Q.hasChildActionFailed,enqueueTimeSec:(Q.B/1E3).toFixed()}},MOk=function(){var Q;
return g.U(function(W){return W.B==1?g.A(W,Zp5(),2):(Q=W.U)?W.return(Q.delete("yt-player-local-img")):W.return(!0)})},VG=function(Q){var W,x;
return g.U(function(D){if(D.B==1)return g.A(D,Zp5(),2);if(D.B!=3){W=D.U;if(!W)throw Error("Cache API not supported");return Q.length?g.A(D,W.open("yt-player-local-img"),3):D.return()}x=D.U;return g.A(D,Promise.all(Q.map(function(K){return x.delete(K)})),0)})},Pz=function(Q){var W,x;
return g.U(function(D){if(D.B==1)return g.A(D,Zp5(),2);if(D.B!=3){W=D.U;if(!W)throw Error("Cache API not supported");return Q.length?g.A(D,W.open("yt-player-local-img"),3):D.return()}x=D.U;return g.A(D,x.addAll(Q),0)})},vz=function(Q,W,x,D,K){var l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El;
return g.U(function(D7){switch(D7.B){case 1:return l=g.Mb(Q,"mainVideoEntity"),M=g.Mb(Q,"ytMainChannelEntity"),w=g.Mb(Q,"transfer"),S=g.Mb(Q,"videoDownloadContextEntity"),g.A(D7,Tc(W,{mode:"readonly",dG:!0},function(uC){return g.CX.all([gU(uC,l,"mainVideoEntity"),gU(uC,M,"ytMainChannelEntity"),gU(uC,w,"transfer"),gU(uC,S,"videoDownloadContextEntity"),y6(uC,"ytMainChannelEntity"),y6(uC,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:b=D7.U;z=g.V(b);k=z.next().value;X=z.next().value;u=z.next().value;Y=z.next().value;v=z.next().value;J=z.next().value;h=k;G=X;H=u;I=Y;c=v;O=J;if(!h&&!G){D7.kf(3);break}T=h?o$(h.thumbnail):[];if(!G){Ks=[];D7.kf(4);break}return g.A(D7,RbC(G,c),5);case 5:Ks=D7.U;case 4:return Mz=Ks,g.A(D7,VG(T.concat(Mz)),3);case 3:QF=[];f=g.Mb(Q,"downloadStatusEntity");t=g.V(O);for(P=t.next();!P.done;P=t.next())Z=P.value,c5=g.jd(Z.key).entityId,vu=Yr(Z),kF=g.jd(vu.action.entityKey).entityId,c5!==Q&&kF!==Q||kr(x,
Z.actionProto)||QF.push(Z.key);return g.A(D7,Tc(W,{mode:"readwrite",dG:!0},function(uC){var p=QF.map(function(a){return Zz(uC,a)});
p.push(Zz(uC,l,{xr:!0}));p.push(Zz(uC,f,{xr:!0}));return g.CX.all(p)}),7);
case 7:El=(a1=I)==null?void 0:a1.offlineModeType,K&&(MV(K),K.offlineModeType&&(El=K.offlineModeType)),Xg(H,El),l_(D,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VF(D7)}})},bZs=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d,q,m,W5,l2,jn,B,b2,o1,w4,Av,XH,Nk,k8;
return g.U(function(fs){switch(fs.B){case 1:return K=g.Mb(Q,"mainPlaylistEntity"),l=g.Mb(Q,"ytMainChannelEntity"),g.A(fs,Tc(W,{mode:"readonly",dG:!0},function(c1){return g.CX.all([gU(c1,K,"mainPlaylistEntity"),gU(c1,l,"ytMainChannelEntity"),y6(c1,"mainPlaylistEntity"),y6(c1,"mainDownloadsListEntity"),y6(c1,"ytMainChannelEntity"),y6(c1,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:M=fs.U;w=g.V(M);S=w.next().value;b=w.next().value;z=w.next().value;k=w.next().value;X=w.next().value;u=w.next().value;Y=S;v=b;J=z;h=k;G=X;H=u;if(!Y&&!v){fs.kf(3);break}I=Y?wFu(Y):[];if(!v){c=[];fs.kf(4);break}return g.A(fs,RbC(v,G),5);case 5:c=fs.U;case 4:return O=c,g.A(fs,VG(I.concat(O)),3);case 3:T=[];Ks=new Map;if(!Y){fs.kf(7);break}return g.A(fs,SaY(Y,J,h),8);case 8:T=fs.U;Mz=g.V(T);for(QF=Mz.next();!QF.done;QF=Mz.next())f=QF.value,Ks.set(f,{videoId:f,playlistId:Q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.A(fs,Tc(W,{mode:"readonly",dG:!0},function(c1){return g.CX.all([y6(c1,"transfer"),y6(c1,"videoDownloadContextEntity")])}),9);
case 9:t=fs.U;P=g.V(t);Z=P.next().value;c5=P.next().value;vu=Z;kF=c5;a1=g.V(vu);for(El=a1.next();!El.done;El=a1.next())D7=El.value,uC=g.jd(D7.key).entityId,(p=Ks.get(uC))&&D7&&(p.cotn=D7.cotn);a=g.V(kF);for(d=a.next();!d.done;d=a.next())q=d.value,m=g.jd(q.key).entityId,(W5=Ks.get(m))&&q&&(W5.offlineModeType=q.offlineModeType);case 7:l2=[];jn=g.V(H);for(B=jn.next();!B.done;B=jn.next())b2=B.value,o1=g.jd(b2.key).entityId,w4=Yr(b2),o1!==Q&&w4.rootActionId!==Q||kr(x,b2.actionProto)||l2.push(b2.key);Av=
g.Mb(Q,"mainPlaylistEntity");return g.A(fs,Tc(W,{mode:"readwrite",dG:!0},function(c1){var SE=l2.map(function(H6){return Zz(c1,H6)});
SE.push(Zz(c1,Av,{xr:!0}));return g.CX.all(SE)}),10);
case 10:if(!Y){fs.kf(0);break}T.reverse();if(!T){fs.kf(0);break}XH=g.V(T);Nk=XH.next();case 13:if(Nk.done){fs.kf(0);break}k8=Nk.value;return g.A(fs,vz(k8,W,x,D,Ks.get(k8)),14);case 14:Nk=XH.next(),fs.kf(13)}})},zb1=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X;
return g.U(function(u){if(u.B==1)return K=g.Mb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),l=new Map,g.A(u,Tc(Q,{mode:"readwrite",dG:!0},function(Y){var v=y6(Y,"transfer"),J=y6(Y,"offlineOrchestrationActionWrapperEntity"),h=y6(Y,"videoDownloadContextEntity"),G=gU(Y,K,"mainDownloadsListEntity");return g.CX.all([v,J,h,G]).then(function(H){H=g.V(H);var I=H.next().value;var c=H.next().value;var O=H.next().value;var T=H.next().value;H=svF.map(function(Mz){return wRY(Y,Mz)});
c=g.V(c);for(var Ks=c.next();!Ks.done;Ks=c.next())Ks=Ks.value,kr(W,Ks.actionProto)||H.push(Zz(Y,Ks.key,{xr:!0}));T&&(T.downloads=[],H.push(fF(Y,T,"mainDownloadsListEntity")));if(O)for(O=g.V(O),T=O.next();!T.done;T=O.next())T=T.value,c=g.jd(T.key).entityId,c=g.Mb(c,"transfer"),l.set(c,T.offlineModeType);return g.CX.all(H).then(function(){return I})})}),2);
M=u.U;w=g.V(M);for(S=w.next();!S.done;S=w.next())b=S.value,Xg(b,l.get(b.key)),z=g.jd(b.key).entityId,k={videoId:z,offlineDeleteReason:D,cotn:b.cotn,offlineModeType:l.get(b.key)},MV(k),X=g.Mb(z,"mainVideoEntity"),l_(x,{entityKey:X,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.A(u,MOk(),0)})},wFu=function(Q,W){var x=[];
if(Q.thumbnailStyleData){Q=g.V(Q.thumbnailStyleData);for(var D=Q.next();!D.done;D=Q.next()){var K=void 0,l=void 0,M=void 0;x=x.concat(o$((K=D.value)==null?void 0:(l=K.value)==null?void 0:(M=l.collageThumbnail)==null?void 0:M.coverThumbnail))}}W=o$(W);return x.concat(W)},SaY=function(Q,W,x){var D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz;
return g.U(function(QF){D=[];K=new Set;if(x.length)for(l=g.V(x),M=l.next();!M.done;M=l.next())if(w=M.value,S=void 0,(S=w.downloads)==null?0:S.length)for(b=g.V(w.downloads),z=b.next();!z.done;z=b.next())k=z.value,k.videoItem&&(X=g.jd(k.videoItem).entityId,K.add(X));if(Q.videos){u=g.V(Q.videos);for(Y=u.next();!Y.done;Y=u.next())v=Y.value,J=JSON.parse(g.jd(v).entityId),J.videoId&&!K.has(J.videoId)&&D.push(J.videoId);h=g.V(W);for(G=h.next();!G.done;G=h.next())if(H=G.value,H.key!==Q.key&&(I=H.videos))for(c=
g.V(I),O=c.next();!O.done;O=c.next())T=O.value,Ks=JSON.parse(g.jd(T).entityId),Ks.videoId&&(Mz=D.indexOf(Ks.videoId),Mz!==-1&&D.splice(Mz,1))}return QF.return(D)})},RbC=function(Q,W){var x,D,K,l,M,w,S,b;
return g.U(function(z){x=o$(Q.avatar);D=g.V(W);for(K=D.next();!K.done;K=D.next())if(l=K.value,l.id!==Q.id)for(M=g.V(o$(l.avatar)),w=M.next();!w.done;w=M.next())S=w.value,b=x.indexOf(S),b!==-1&&x.splice(b,1);return z.return(x)})},kNA=function(Q){var W;
return g.U(function(x){W=g.e(Q.frameworkUpdates,Ce);return Q.frameworkUpdates&&W?g.A(x,vgs(W),0):x.return()})},okF=function(Q){var W;
if((W=Q.onResponseReceivedActions)!=null&&W.length){var x;Q=(x=g.e(g.e(Q.onResponseReceivedActions[0],XF5),g.U35))==null?void 0:x.actions;if(Q!=null&&Q.length)return Q}},uZR=function(Q){var W,x,D;
return g.U(function(K){if(K.B==1)return Q?g.A(K,E8(Q,g.UK,"mainDownloadsListEntity"),2):K.return([]);W=K.U;return((x=W)==null?0:(D=x.downloads)==null?0:D.length)?K.return(W.downloads.map(function(l){var M;return(M=l.videoItem)!=null?M:""})):K.return([])})},nk1=function(Q,W){var x;
return g.U(function(D){return D.B==1?g.A(D,Yap(Q,W),2):(x=D.U)?g.A(D,Tc(Q,{mode:"readwrite",dG:!0},function(K){var l=[fF(K,x.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];x.mainDownloadsListEntity&&l.push(fF(K,x.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.CX.all(l)}),0):D.kf(0)})},Yap=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H;
return g.U(function(I){if(I.B==1)return x=g.Mb("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.Mb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.A(I,Tc(Q,{mode:"readonly",dG:!0},function(c){return g.CX.all([gU(c,x,"mainDownloadsLibraryEntity"),gU(c,D,"mainDownloadsListEntity")])}),2);
K=I.U;l=g.V(K);M=l.next().value;w=l.next().value;S=M;b=w;S||(S={id:x});z=g.V(W);for(k=z.next();!k.done;k=z.next())if(X=k.value,X===g.UK){if(S.smartDownloadsList)return I.return();S.smartDownloadsList=X}else if(u=g.jd(X).entityType,Y={},u==="mainPlaylistEntity"?Y.playlistItem=X:u==="mainVideoEntity"&&(Y.videoItem=X),!g.dS(Y)){v=void 0;if((v=b)==null?0:v.downloads){J=!1;h=g.V(b.downloads);for(G=h.next();!G.done;G=h.next())if(H=G.value,H.playlistItem===X||H.videoItem===X){J=!0;break}J||b.downloads.push(Y)}else b=
{id:D,downloads:[Y]};S.downloadsList=D}return I.return({mainDownloadsLibraryEntity:S,mainDownloadsListEntity:b})})},VO1=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J;
return g.U(function(h){if(h.B==1)return x=g.Mb("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.Mb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.A(h,Tc(Q,{mode:"readonly",dG:!0},function(G){return g.CX.all([gU(G,x,"mainDownloadsLibraryEntity"),gU(G,D,"mainDownloadsListEntity"),gU(G,g.UK,"mainDownloadsListEntity")])}),2);
K=h.U;l=g.V(K);M=l.next().value;w=l.next().value;S=l.next().value;b=M;z=w;k=S;if(!b)return h.kf(0);if(W===g.UK&&((X=k)==null?0:X.downloads))k.downloads=[];else if((u=z)==null?0:u.downloads)for(Y=g.jd(W).entityType,v=0;v<z.downloads.length;v++)if(J=z.downloads[v],Y==="mainVideoEntity"&&J.videoItem===W){z.downloads.splice(v,1);break}else if(Y==="mainPlaylistEntity"&&J.playlistItem===W){z.downloads.splice(v,1);break}return g.A(h,Tc(Q,{mode:"readwrite",dG:!0},function(G){var H=[fF(G,b,"mainDownloadsLibraryEntity")];
z&&H.push(fF(G,z,"mainDownloadsListEntity"));k&&H.push(fF(G,k,"mainDownloadsListEntity"));return g.CX.all(H)}),0)})},JM=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X;
return g.U(function(u){if(u.B==1)return x=g.Mb(W,"transfer"),D=g.Mb(W,"videoDownloadContextEntity"),g.A(u,Tc(Q,{mode:"readonly",dG:!0},function(Y){return g.CX.all([gU(Y,x,"transfer"),gU(Y,D,"videoDownloadContextEntity")])}),2);
K=u.U;l=g.V(K);M=l.next().value;w=l.next().value;S=M;b=w;X={videoId:W,cotn:(z=S)==null?void 0:z.cotn,offlineModeType:(k=b)==null?void 0:k.offlineModeType};return u.return(X)})},pe=function(Q,W,x,D,K){var l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks;
return g.U(function(Mz){switch(Mz.B){case 1:return l=g.Mb(Q,"musicTrack"),M=g.Mb(Q,"transfer"),g.A(Mz,Tc(W,{mode:"readonly",dG:!0},function(QF){return g.CX.all([gU(QF,l,"musicTrack"),gU(QF,M,"transfer"),y6(QF,"musicTrack"),y6(QF,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:w=Mz.U;S=g.V(w);b=S.next().value;z=S.next().value;k=S.next().value;X=S.next().value;u=b;Y=z;v=k;J=X;if(!u){Mz.kf(3);break}return g.A(Mz,PxJ(u,v),4);case 4:return h=Mz.U,g.A(Mz,VG(h),3);case 3:G=[];H=g.V(J);for(I=H.next();!I.done;I=H.next())c=I.value,O=g.jd(c.key).entityId,T=Yr(c),Ks=g.jd(T.action.entityKey).entityId,O!==Q&&Ks!==Q||kr(x,c.actionProto)||G.push(c.key);return g.A(Mz,Tc(W,{mode:"readwrite",dG:!0},function(QF){var f=G.map(function(t){return Zz(QF,t)});
f.push(Zz(QF,l,{xr:!0}));return g.CX.all(f)}),6);
case 6:Xg(Y),K&&MV(K),l_(D,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.VF(Mz)}})},hM=function(Q,W,x,D,K){var l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d;
return g.U(function(q){switch(q.B){case 1:return l=g.Mb(Q,W),M=g.Mb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.A(q,Tc(x,{mode:"readonly",dG:!0},function(m){return g.CX.all([gU(m,l,W),gU(m,M,"musicDownloadsLibraryEntity"),y6(m,W),y6(m,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:w=q.U;S=g.V(w);b=S.next().value;z=S.next().value;k=S.next().value;X=S.next().value;u=b;Y=z;v=k;J=X;if(!u){q.kf(3);break}return g.A(q,PxJ(u,v),4);case 4:return h=q.U,g.A(q,VG(h),3);case 3:G=[];H=new Map;if(!u){q.kf(6);break}return g.A(q,vks(u,v,Y),7);case 7:G=q.U;I=g.V(G);for(c=I.next();!c.done;c=I.next())O=c.value,T=g.jd(O).entityId,H.set(T,{videoId:T,playlistId:Q,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.A(q,FM(x,"transfer"),8);case 8:for(Ks=q.U,Mz=g.V(Ks),
QF=Mz.next();!QF.done;QF=Mz.next())f=QF.value,t=g.jd(f.key).entityId,(P=H.get(t))&&f&&(P.cotn=f.cotn);case 6:Z=[];c5=g.V(J);for(vu=c5.next();!vu.done;vu=c5.next())kF=vu.value,a1=g.jd(kF.key).entityId,El=Yr(kF),a1!==Q&&El.rootActionId!==Q||kr(D,kF.actionProto)||Z.push(kF.key);D7=g.Mb(Q,W);return g.A(q,Tc(x,{mode:"readwrite",dG:!0},function(m){var W5=Z.map(function(l2){return Zz(m,l2)});
W5.push(Zz(m,D7,{xr:!0}));return g.CX.all(W5)}),9);
case 9:if(!u){q.kf(0);break}G.reverse();if(!G.length){q.kf(0);break}uC=g.V(G);p=uC.next();case 12:if(p.done){q.kf(0);break}a=p.value;d=g.jd(a).entityId;if(!d){q.kf(13);break}return g.A(q,pe(d,x,D,K,H.get(d)),13);case 13:p=uC.next(),q.kf(12)}})},a$=function(Q,W,x){var D,K,l,M,w,S,b;
return g.U(function(z){if(z.B==1)return g.A(z,Tc(Q,{mode:"readwrite",dG:!0},function(k){var X=y6(k,"transfer"),u=y6(k,"offlineOrchestrationActionWrapperEntity");return g.CX.all([X,u]).then(function(Y){Y=g.V(Y);var v=Y.next().value;var J=Y.next().value;Y=CxY.map(function(I){return wRY(k,I)});
J=g.V(J);for(var h=J.next();!h.done;h=J.next()){h=h.value;var G=g.jd(h.actionProto.entityKey).entityType==="musicTrack",H=h.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";kr(W,h.actionProto)||G&&(!G||H)||Y.push(Zz(k,h.key,{xr:!0}))}return g.CX.all(Y).then(function(){return v})})}),2);
D=z.U;K=g.V(D);for(l=K.next();!l.done;l=K.next())M=l.value,Xg(M),w=g.jd(M.key).entityId,S={videoId:w,offlineDeleteReason:void 0,cotn:M.cotn},MV(S),b=g.Mb(w,"musicTrack"),l_(x,{entityKey:b,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.A(z,MOk(),0)})},JH1=function(Q){for(var W,x=g.V(Q.additionalMetadatas),D=x.next();!D.done;D=x.next())D=D.value,D.offlineMusicVideoData&&(W=D.offlineMusicVideoData);
var K,l,M,w,S;return{id:g.Mb(Q.videoId,"musicTrack"),videoId:Q.videoId,title:Q.title,thumbnailDetails:Q.thumbnail,lengthMs:String(Number(Q.lengthSeconds)*1E3),albumTitle:(K=W)==null?void 0:K.releaseTitle,musicVideoType:(l=W)==null?void 0:l.musicVideoType,contentRating:{explicitType:(M=W)==null?void 0:M.explicitType},artistNames:((w=W)==null?void 0:w.byline)||((S=W)==null?void 0:S.channelName),downloadMetadata:g.Mb(Q.videoId,"musicTrackDownloadMetadataEntity")}},vks=function(Q,W,x){var D,K,l,M,w,S,
b,z,k,X,u,Y,v,J,h,G,H,I;
return g.U(function(c){D=[];K=new Set;if((l=x)==null?0:(M=l.downloadedTracks)==null?0:M.length)for(w=g.V(x.downloadedTracks),S=w.next();!S.done;S=w.next())b=S.value,K.add(b);if(Q.tracks){z=g.V(Q.tracks);for(k=z.next();!k.done;k=z.next())X=k.value,K.has(X)||D.push(X);u=g.V(W);for(Y=u.next();!Y.done;Y=u.next())if(v=Y.value,v.id!==Q.id&&(J=v.tracks))for(h=g.V(J),G=h.next();!G.done;G=h.next())H=G.value,I=D.indexOf(H),I!==-1&&D.splice(I,1)}return c.return(D)})},PxJ=function(Q,W){var x,D,K,l,M,w,S,b;
return g.U(function(z){x=o$(Q.thumbnailDetails);D=g.V(W);for(K=D.next();!K.done;K=D.next())if(l=K.value,l.id!==Q.id)for(M=g.V(o$(l.thumbnailDetails)),w=M.next();!w.done;w=M.next())S=w.value,b=x.indexOf(S),b!==-1&&x.splice(b,1);return z.return(x)})},pFe=function(Q,W){var x,D,K,l,M,w,S,b,z;
return g.U(function(k){if(k.B==1)return x=g.Mb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.A(k,E8(Q,x,"musicDownloadsLibraryEntity"),2);(D=k.U)||(D={id:x});K=g.jd(W).entityType;K==="musicTrack"?(l=D.downloadedTracks)!=null&&l.includes(W)||(D.downloadedTracks=((M=D.downloadedTracks)!=null?M:[]).concat(W)):K==="musicPlaylist"?(w=D.downloadedPlaylists)!=null&&w.includes(W)||(D.downloadedPlaylists=((S=D.downloadedPlaylists)!=null?S:[]).concat(W)):K!=="musicAlbumRelease"||(b=D.downloadedAlbumReleases)!=
null&&b.includes(W)||(D.downloadedAlbumReleases=((z=D.downloadedAlbumReleases)!=null?z:[]).concat(W));return g.A(k,O8(Q,D,"musicDownloadsLibraryEntity"),0)})},hbA=function(Q,W){var x,D,K,l,M,w,S;
return g.U(function(b){if(b.B==1)return x=g.Mb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.A(b,E8(Q,x,"musicDownloadsLibraryEntity"),2);D=b.U;if(!D)return b.kf(0);K=g.jd(W).entityType;K==="musicTrack"?l=D.downloadedTracks:K==="musicPlaylist"&&(l=D.downloadedPlaylists);if((M=l)==null?0:M.length)for(w=0;w<l.length;w++)if(S=l[w],S===W){l.splice(w,1);break}return g.A(b,O8(Q,D,"musicDownloadsLibraryEntity"),0)})},aG7=function(Q){var W=Q.videos;
Q=[];var x=[];if(W){W=g.V(W);for(var D=W.next();!D.done;D=W.next()){var K=D.value.offlineVideoData.videoId;D=g.Mb(K,"musicTrack");K=g.Mb(K,"musicTrackDownloadMetadataEntity");Q.push(D);x.push(K)}}return{mK:Q,UE:x}},G9=function(Q,W,x){W={track:JH1(W)};
x&&(W.playlistId=x);if(Q=g.e(Q.actionMetadata,GNH))W.maximumDownloadQuality=Q.maximumDownloadQuality;return{musicTrackEntityActionMetadata:W}},iZC=function(Q){var W,x,D,K,l,M,w,S;
return g.U(function(b){switch(b.B){case 1:return W=g.ll(),x=ip1(Q),D=g.Q_(d7C),g.P5(b,2),l={Yg:!0},g.A(b,g.Ti(W,x,D,void 0,l),4);case 4:K=b.U;g.Cs(b,3);break;case 2:M=g.Jv(b);if(M instanceof g.Zx)throw w="GetOffline network manager error: "+M.message,Dq(w,M),Error(w);Dq("GetOffline fetch request error",M);throw Error("GetOffline fetch request error");case 3:S=dA(K);if(!K)throw Dq("Network request failed"),Error("Network request failed");if(S!==void 0)i_(S);else if(!K.videos||!K.videos.length)throw Dq("No data"),
Error("No data");return b.return(K.videos.map(function(z){return z.offlineVideoData}))}})},AHJ=function(Q){var W,x,D,K,l,M,w,S;
return g.U(function(b){switch(b.B){case 1:return W=g.ll(),x=APF(Q),D=g.Q_(d7C),g.P5(b,2),l={Yg:!0},g.A(b,g.Ti(W,x,D,void 0,l),4);case 4:K=b.U;g.Cs(b,3);break;case 2:M=g.Jv(b);if(M instanceof g.Zx)throw w="GetOffline network manager error for playlist: "+M.message,Dq(w,M),Error(w);Dq("GetOffline fetch request error for playlist",M);throw Error("GetOffline fetch request error for playlist");case 3:S=dA(K);if(!K)throw Dq("Network request failed for playlist"),Error("Network request failed for playlist");
if(S!==void 0)i_(S,"playlist");else if(!K.playlists||!K.playlists.length)throw Dq("No data for playlist"),Error("No data for playlist");return b.return(K.playlists.map(function(z){return z.offlinePlaylistData}))}})},U7J=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF;
return g.U(function(a1){switch(a1.B){case 1:return g.A(a1,t9(),2);case 2:K=a1.U;if(!K)return a1.return([]);l=[];if((M=D)==null?0:M.length){l=D;a1.kf(3);break}return g.A(a1,FM(K,"mainPlaylistEntity"),4);case 4:l=a1.U;case 3:if(!l.length)return a1.return([]);w=[];S=Date.now()/1E3;b=g.V(l);z=b.next();case 5:if(z.done)return w.length?g.A(a1,HZH(w),10):a1.return([]);k=z.value;if(!k.downloadState){X=void 0;a1.kf(8);break}return g.A(a1,E8(K,k.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:X=
a1.U;case 8:u=X;Y=void 0;J=(v=(Y=k)==null?void 0:Y.entityMetadata)&&v.nextAutoRefreshIntervalSeconds?Number(v.nextAutoRefreshIntervalSeconds):NaN;h=Number.isNaN(J)?Q:J;H=G=void 0;I=((G=u)==null?0:G.lastSyncedTimestampMillis)?Number((H=u)==null?void 0:H.lastSyncedTimestampMillis)/1E3:0;O=c=void 0;T=((c=u)==null?0:c.addedTimestampMillis)?Number((O=u)==null?void 0:O.addedTimestampMillis)/1E3:0;if(x||!v||I+h<=S){Ks=[];Mz=void 0;if((Mz=k.videos)==null?0:Mz.length)for(QF=g.V(k.videos),f=QF.next();!f.done;f=
QF.next())t=f.value,P=JSON.parse(g.jd(t).entityId),P.videoId&&Ks.push(P.videoId);Z="0";v&&(c5=void 0,Z=String(Number((c5=v.offlineLastModifiedTimestampSeconds)!=null?c5:0).toFixed()));vu={playlistId:k.playlistId,videoIds:Ks,offlineLastModifiedTimestamp:Z,autoSync:W,offlineDateAddedTimestamp:String(T.toFixed())};w.push(vu)}z=b.next();a1.kf(5);break;case 10:return kF=a1.U,a1.return(kF)}})},qap=function(){var Q,W,x,D,K;
return g.U(function(l){if(l.B==1)return g.A(l,t9(),2);if(l.B!=3)return(Q=l.U)?g.A(l,FM(Q,"refresh"),3):l.return(!1);W=l.U;if((x=W[0])==null||!x.refreshTime)return l.return(!1);D=Number(W[0].refreshTime);K=Date.now()/1E3;return l.return(isFinite(D)&&K>=D)})},$7k=function(Q,W){var x,D,K;
return g.U(function(l){switch(l.B){case 1:return g.P5(l,2),g.A(l,BJ5(Q,W),4);case 4:return D=l.U,g.A(l,kNA(D),5);case 5:x=okF(D);g.Cs(l,3);break;case 2:K=g.Jv(l),Dq("getAndProcessSmartDownloadsResponse request or processing error",K);case 3:return l.return(x)}})},IGs=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF;
return g.U(function(a1){switch(a1.B){case 1:return g.A(a1,t9(),2);case 2:K=a1.U;if(!K)return a1.return([]);l=[];if((M=D)==null?0:M.length){l=D;a1.kf(3);break}return g.A(a1,FM(K,"musicPlaylist"),4);case 4:l=a1.U;case 3:if(!l.length)return a1.return([]);w=[];S=Date.now()/1E3;b=g.V(l);z=b.next();case 5:if(z.done)return w.length?g.A(a1,HZH(w),10):a1.return([]);k=z.value;X=void 0;Y=(u=(X=k)==null?void 0:X.entityMetadata)&&u.nextAutoRefreshIntervalSeconds?Number(u.nextAutoRefreshIntervalSeconds):NaN;v=
Number.isNaN(Y)?Q:Y;h=J=0;G="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!k.downloadMetadata){a1.kf(8);break}return g.A(a1,E8(K,k.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:H=a1.U,c=I=void 0,J=Number((c=(I=H)==null?void 0:I.addedTimestampMillis)!=null?c:"0")/1E3,T=O=void 0,h=Number((T=(O=H)==null?void 0:O.lastModifiedTimestampMillis)!=null?T:"0")/1E3,Mz=Ks=void 0,G=(Mz=(Ks=H)==null?void 0:Ks.syncState)!=null?Mz:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:QF=void 0;if(x||G!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!u||Number((QF=u.lastSyncedTimestampSeconds)!=null?QF:0)+v<=S){f=[];t=void 0;if((t=k.tracks)==null?0:t.length)for(P=g.V(k.tracks),Z=P.next();!Z.done;Z=P.next())c5=Z.value,f.push(g.jd(c5).entityId);vu={playlistId:k.playlistId,videoIds:f,offlineLastModifiedTimestamp:String(h.toFixed()),autoSync:W,offlineDateAddedTimestamp:String(J.toFixed())};w.push(vu)}z=b.next();a1.kf(5);break;case 10:return kF=a1.U,a1.return(kF)}})},BJ5=function(Q,W){var x,D,K,l,M,w,S,b,z,k;
return g.U(function(X){switch(X.B){case 1:return x=g.ll(),g.A(X,t9(),2);case 2:D=X.U;if(!D){X.kf(3);break}return g.A(X,mIR(D),4);case 4:K=X.U;case 3:var u=K;l={context:g.EH(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Q},offlineClientState:u,clientStateRequestData:{preferredFormatType:W}}}};M=g.Q_(m7q);g.P5(X,5);S={Yg:!0};return g.A(X,g.Ti(x,l,M,void 0,S),7);case 7:w=X.U;g.Cs(X,6);break;case 5:b=g.Jv(X);if(b instanceof g.Zx)throw z=
"DPS network manager error for smart downloads: "+b.message,Dq(z,b),Error(z);Dq("DPS fetch request error for smart downloads",b);throw Error("DPS fetch request error for smart downloads");case 6:k=dA(w);if(w)k!==void 0&&i_(k,"smart downloads");else throw Dq("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return X.return(w)}})},cHA=function(Q,W){var x,D,K,l,M,w,S,b;
return g.U(function(z){switch(z.B){case 1:return x=g.ll(),D={context:g.EH(),videoPlaybackPositionEntities:Q,lastSyncTimestampUsec:W},K=g.Q_(NJe),g.P5(z,2),M={Yg:!0},g.A(z,g.Ti(x,D,K,void 0,M),4);case 4:l=z.U;g.Cs(z,3);break;case 2:w=g.Jv(z);if(w instanceof g.Zx)throw S="VPPS network manager error: "+w.message,Dq(S,w),Error(S);Dq("VPPS fetch request error",w);throw Error("VPPS fetch request error");case 3:b=dA(l);if(l)b!==void 0&&i_(b,"position sync");else throw Dq("Network request failed for position sync"),
Error("Network request failed for position sync");return z.return(l)}})},yH1=function(Q,W,x){var D,K,l,M,w,S,b,z;
return g.U(function(k){switch(k.B){case 1:D=g.ll();var X=x.refreshData,u=x.isEnqueuedForExpiredStreamUrlRefetch,Y=x.HT,v=x.offlineSourceData,J=x.mediaCapabilities,h={entityKey:Q};X&&(h.refreshData=X);u&&(h.isExpiredStreamUrlRefetch=u);Y&&(h.downloadParameters=Y);v&&(h.offlineSourceData=v);X={context:g.lL(W),signatureTimestamp:20150,videos:[h]};J&&(X.mediaCapabilities=J);K=X;l=g.Q_(gkY);g.P5(k,2);w={Yg:!0};return g.A(k,g.Ti(D,K,l,void 0,w),4);case 4:M=k.U;g.Cs(k,3);break;case 2:S=g.Jv(k);if(S instanceof
g.Zx)throw b="GetPDE network manager error: "+S.message,Dq(b,S),Error(b);Dq("GetPDE fetch request error",S);throw Error("GetPDE fetch request error");case 3:z=dA(M);if(M)z!==void 0&&i_(z,"PDE");else throw Dq("Network request failed for PDE"),Error("Network request failed for PDE");return k.return(M)}})},dA=function(Q){var W;
return(W=Q.errorMetadata)==null?void 0:W.status},i_=function(Q,W){W=W?" for "+W:"";
if(Q===0)throw Q="Empty response body"+W,Dq(Q),Error(Q);Q="Response with error"+W;Dq(Q);throw Error(Q);},HZH=function(Q){var W,x,D,K,l,M,w,S;
return g.U(function(b){switch(b.B){case 1:return W=g.ll(),x=Hpe(Q),D=g.Q_(eb1),g.P5(b,2),l={Yg:!0},g.A(b,g.Ti(W,x,D,void 0,l),4);case 4:K=b.U;g.Cs(b,3);break;case 2:M=g.Jv(b);if(M instanceof g.Zx)throw w="offlinePlaylistSyncCheck network manager error: "+M.message,Dq(w,M),Error(w);Dq("offlinePlaylistSyncCheck fetch request error",M);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:S=dA(K);if(!K)throw Dq("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(S!==void 0)i_(S,"playlist sync");else if(!K.offlinePlaylistSyncCheckDatas||!K.offlinePlaylistSyncCheckDatas.length)throw Dq("No data for playlist sync"),Error("No data for playlist sync");return b.return(K.offlinePlaylistSyncCheckDatas.map(function(z){return z.offlinePlaylistSyncCheckData}))}})},AM=function(Q){this.B=Q},fGJ=function(Q,W){var x,D,K,l,M,w;
return g.U(function(S){switch(S.B){case 1:x=new Map,D=g.V(W),K=D.next();case 2:if(K.done){S.kf(4);break}l=K.value;M=x;w=M.set;return g.A(S,Q.U(l),5);case 5:w.call(M,l,S.U);K=D.next();S.kf(2);break;case 4:return S.return(x)}})},Hz=function(Q,W,x,D,K,l){W=g.Mb(W,x);
D=Object.assign({},l,{priority:D,retryScheduleIntervalsInSeconds:K});return{actionType:Q,entityKey:W,actionMetadata:D}},U4=function(Q,W,x,D,K,l){this.status=Q;
this.B=W;this.N=x;this.U=D;this.D=K;this.downloadState=l},ZZ1=function(Q,W,x){this.B=Q;
this.bj=W;this.D=x},TJR=function(Q,W){var x,D,K,l,M,w,S,b,z;
return g.U(function(k){switch(k.B){case 1:return x=W.entityKey,K=(D=g.e(W.actionMetadata,qV))==null?void 0:D.isEnqueuedForExpiredStreamUrlRefetch,g.P5(k,2),l=void 0,g.A(k,Lbs(Q,W),4);case 4:l=k.U;g.P5(k,5);var X=(X=g.e(W.actionMetadata,qV))?{maximumDownloadQuality:X.maximumDownloadQuality}:void 0;return g.A(k,yH1(x,Q.bj,{isEnqueuedForExpiredStreamUrlRefetch:K,HT:X,offlineSourceData:l}),7);case 7:M=k.U;g.Cs(k,6,2);break;case 5:return g.Jv(k,2),w=wA(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Dq("PDE handleAdd error"),k.return(Bz(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",w,"DOWNLOAD_STATE_FAILED"));case 6:return g.A(k,rHe(Q,M,W),8);case 8:return k.return(Bz(W,!0,M.orchestrationActions));case 2:return S=g.Jv(k),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.o8&&S.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Dq("PDE handleAdd error"),k.return(Bz(W,!1,void 0,b,z,"DOWNLOAD_STATE_FAILED"))}})},FbR=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz;
return g.U(function(QF){switch(QF.B){case 1:return x=W.entityKey,D=g.jd(x).entityId,g.A(QF,Tc(Q.B,{mode:"readonly",dG:!0},function(f){var t=gU(f,x,"playbackData"),P=gU(f,g.Mb(D,"offlineVideoPolicy"),"offlineVideoPolicy");f=gU(f,g.Mb(D,"transfer"),"transfer");return g.CX.all([t,P,f])}),2);
case 2:K=QF.U;l=g.V(K);M=l.next().value;w=l.next().value;S=l.next().value;b=M;z=w;k=S;if(!b||!z)return QF.return(Bz(W,!0));X=[];v=((Y=b)==null?0:Y.playerResponseJson)?JSON.parse(b.playerResponseJson):null;if(!(k&&v&&Q.bj.j("html5_refresh_deprecated_downloads"))){QF.kf(3);break}u=OZA(Q,v,k);return g.A(QF,Ek5(Q,k),4);case 4:X=QF.U;case 3:J={lastPlayerResponseTimestampSeconds:b.playerResponseTimestamp,offlineToken:z.offlineToken,formatIds:X};h={};if((G=k)==null?0:G.maximumDownloadQuality)h.maximumDownloadQuality=
k.maximumDownloadQuality;g.P5(QF,5);H=void 0;return g.A(QF,Lbs(Q,W),7);case 7:return H=QF.U,g.P5(QF,8),g.A(QF,yH1(x,Q.bj,{refreshData:J,HT:h,offlineSourceData:H,mediaCapabilities:u}),10);case 10:I=QF.U;g.Cs(QF,9,5);break;case 8:return g.Jv(QF,5),c=wA(W)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Dq("PDE handleRefresh error"),QF.return(Bz(W,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,
"DOWNLOAD_STATE_FAILED"));case 9:return g.A(QF,rHe(Q,I,W),11);case 11:return QF.return(Bz(W,!0,I.orchestrationActions));case 5:return O=g.Jv(QF),T="PDE handleRefresh error",O instanceof Error&&(T="PDE handleRefresh error: "+O.message),Ks="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Mz="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",O instanceof g.o8&&O.type==="QUOTA_EXCEEDED"&&(Ks="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Mz="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Dq(T),QF.return(Bz(W,!1,void 0,Ks,Mz,"DOWNLOAD_STATE_FAILED"))}})},Lbs=function(Q,W){var x,D,K,l;
return g.U(function(M){if(M.B==1)return x=g.jd(W.entityKey).entityId,D=g.Mb(x,"videoDownloadContextEntity"),g.A(M,E8(Q.B,D,"videoDownloadContextEntity"),2);K=M.U;return(l=K)!=null&&l.offlineModeType?M.return({offlineModeType:K.offlineModeType}):M.return(void 0)})},rHe=function(Q,W,x){var D,K,l,M,w;
return g.U(function(S){if(S.B==1){if(!W.frameworkUpdates||!g.e(W.frameworkUpdates,Ce))return S.return();if(!(g.e(W.frameworkUpdates,Ce).mutations&&g.e(W.frameworkUpdates,Ce).mutations.length>0&&g.e(W.frameworkUpdates,Ce).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return S.kf(2);D=g.jd(g.e(W.frameworkUpdates,Ce).mutations[0].entityKey).entityId;return g.A(S,JM(Q.B,D),3)}if(S.B!=2){K=S.U;l=g.e(x.actionMetadata,qV);if(w=(M=l)==null?void 0:M.playlistId)K.playlistId=w;K.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ET(Q.bj)?g.A(S,vz(D,Q.B,x,Q.D,K),2):g.Il(Q.bj)?g.A(S,pe(D,Q.B,x,Q.D),2):S.kf(2)}return g.A(S,vgs(g.e(W.frameworkUpdates,Ce)),0)})},Bz=function(Q,W,x,D,K,l){return new U4(W?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",wA(Q),x,D,K,l)},OZA=function(Q,W,x){W=lGs(Q.bj,x.cotn,W);
x=g.R4(W);return g.cWF(W,x,Q.bj)},Ek5=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X;
return g.U(function(u){if(u.B==1)return x=[],g.A(u,Tc(Q.B,{mode:"readonly",dG:!0},function(Y){var v=[],J=W.offlineVideoStreams;if(J){J=g.V(J);for(var h=J.next();!h.done;h=J.next())v.push(gU(Y,h.value,"offlineVideoStreams"))}return g.CX.all(v)}),2);
if(D=u.U)for(K=g.V(D),l=K.next();!l.done;l=K.next())if(M=l.value,w=void 0,(w=M)==null?0:w.streamsProgress)for(S=M.streamsProgress,b=0;b<S.length;b++)z=S[b],k=JSON.parse(z.formatStreamBytes),X={itag:k.itag,lmt:k.lastModified,xtags:k.xtags},x.push(X);return u.return(x)})},tOu=function(Q,W){this.B=Q;
this.bj=W},Qbs=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u;
return g.U(function(Y){switch(Y.B){case 1:return x=wA(W),g.A(Y,FM(Q.B,"videoPlaybackPositionEntity"),2);case 2:D=Y.U;if(D.length===0)return Y.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.P5(Y,3);return g.A(Y,m8.getInstance(),5);case 5:K=Y.U;if(!K)throw Error("prefStorage is undefined");return g.A(Y,K.get("psi"),6);case 6:return l=Y.U,S=(w=(M=l)==null?void 0:M.i5)!=null?w:"0",g.A(Y,cHA(D,S),7);case 7:return b=Y.U,z={isPaused:b.watchHistoryPaused,i5:b.syncTimestampUsec},g.A(Y,K.set("psi",
z),8);case 8:if(z.isPaused){Y.kf(9);break}k=g.e(b.frameworkUpdates,Ce);if(!b.frameworkUpdates||!k){Y.kf(9);break}return g.A(Y,vgs(k),9);case 9:g.Cs(Y,4);break;case 3:return X=g.Jv(Y),u="PPE handleRefresh error: "+(X instanceof Error?X.message:"unknown error"),Dq(u),Y.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Y.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},xnA=function(Q,W){var x,D,K,l,M,w,S,b;
return g.U(function(z){switch(z.B){case 1:return x=wA(W),D=g.jd(W.entityKey).entityId,g.P5(z,2),g.A(z,m8.getInstance(),4);case 4:K=z.U;if(!K)throw Error("prefStorage is undefined");return g.A(z,K.get("psi"),5);case 5:l=z.U;M=g.e(W.actionMetadata,Wiu);if(((w=l)==null?void 0:w.isPaused)!==!1||(S=M)==null||!S.lastPlaybackPositionSeconds){z.kf(6);break}b={key:g.Mb(D,"videoPlaybackPositionEntity"),videoId:D,lastPlaybackPositionSeconds:M.lastPlaybackPositionSeconds};return g.A(z,O8(Q.B,b,"videoPlaybackPositionEntity"),
6);case 6:g.Cs(z,3);break;case 2:return g.Jv(z),z.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return z.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},DnY=function(Q,W){var x,D,K;
return g.U(function(l){switch(l.B){case 1:x=wA(W);g.P5(l,2);D=g.jd(W.entityKey).entityId;if(D==="!*$_ALL_ENTITIES_!*$")return g.A(l,u9p(Q.B),5);K=g.Mb(D,"videoPlaybackPositionEntity");return g.A(l,ogF(Q.B,K),5);case 5:g.Cs(l,3);break;case 2:return g.Jv(l),l.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},KiA=function(Q,W){this.api=Q;
this.B=W;this.logger=new g.MP("woffle");this.U=!1;this.by={xB:this.xB};this.logger.debug("Initialized OfflineMediaManager")},lHH=function(Q){return g.U(function(W){return W.return(dIC(Q))})},jbF=function(Q){var W;
return g.U(function(x){if(x.B==1)return g.A(x,g.zm4(Q),2);W=x.U;return x.return(W.filter(function(D){return!!D.url}).map(function(D){return D.url}))})},$r=function(Q,W){var x=g.ib(W);
if(x===1||x===0)return Promise.resolve();(x=MlH(Q,W))&&x.stopVideo();Q.D=0;return lHH(W)},I$=function(Q,W,x,D){x=x===void 0?!1:x;
D=D===void 0?!0:D;var K=typeof W==="string"?W:W.videoDetails.videoId;g.ib(K)===2&&((W=MlH(Q,K))?W.stopVideo():Q.logger.info(function(){return"Corresponding player for "+K+" not found. Pausing anyway"}),g.AQ(K,2),Q.D=2,x?Rpp(Q.B):D&&wtR(Q.B))},MlH=function(Q,W){var x;
return((x=Q.player)==null?void 0:x.getVideoData().videoId)===W?Q.player:null},S37=function(Q,W,x){W.getPlayerResponse();
g.AQ(W.videoId,2);Q.D=2;Q.U=!1;var D;(D=Q.player)==null||D.dispose();Q.player=Q.api.rL(W);W={};Q.player.xJ((W.localmediachange=Q.Sb,W.signatureexpired=Q.Ai,W.statechange=Q.LJ9,W),Q);var K=Q.xB(x);Q.player.D2(g.jw(K,K,!0,"m"),!1);Q.logger.debug(function(){return"Starting headless playback with quality: "+K});
Q.player.A7(!1)},b8R=function(Q,W){this.B=Q;
this.bj=W},zpe=function(Q,W){var x,D;
return g.U(function(K){switch(K.B){case 1:return x=wA(W),g.A(K,E8(Q.B,W.entityKey,"transfer"),2);case 2:if(D=K.U)return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.P5(K,3);return g.A(K,sb1(Q,W),5);case 5:g.Cs(K,4);break;case 3:return g.Jv(K),K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},kdp=function(Q,W){var x,D;
return g.U(function(K){switch(K.B){case 1:return x=wA(W),g.A(K,E8(Q.B,W.entityKey,"transfer"),2);case 2:D=K.U;if(!D||D.transferState!=="TRANSFER_STATE_COMPLETE")return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.P5(K,3);return g.A(K,sb1(Q,W,!0),5);case 5:g.Cs(K,4);break;case 3:return g.Jv(K),K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},Xtp=function(Q,W){var x,D,K,l,M,w,S,b,z,k;
return g.U(function(X){switch(X.B){case 1:return x=wA(W),D=g.jd(W.entityKey).entityId,g.A(X,Tc(Q.B,{mode:"readonly",dG:!0},function(u){var Y=gU(u,W.entityKey,"transfer");u=gU(u,g.Mb(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CX.all([Y,u])}),2);
case 2:K=X.U;l=g.V(K);M=l.next().value;w=l.next().value;S=M;b=w;if(!S||S.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return X.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.P5(X,3);S.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.A(X,O8(Q.B,S,"transfer"),5);case 5:z=g.jd(S.key).entityId;R$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:z,t9:S,offlineModeType:(k=b)==null?void 0:k.offlineModeType});g.Cs(X,
4);break;case 3:return g.Jv(X),X.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return X.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},sb1=function(Q,W,x){x=x===void 0?!1:x;
var D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h;return g.U(function(G){switch(G.B){case 1:return D=g.e(W.actionMetadata,oB1),K=g.jd(W.entityKey).entityId,l=g.Mb(K,"downloadStatusEntity"),g.A(G,Tc(Q.B,{mode:"readonly",dG:!0},function(H){var I=gU(H,l,"downloadStatusEntity");H=gU(H,g.Mb(K,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CX.all([I,H])}),2);
case 2:return M=G.U,w=g.V(M),S=w.next().value,b=w.next().value,z=S,k=b,X="TRANSFER_STATE_TRANSFER_IN_QUEUE",((u=z)==null?void 0:u.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(X="TRANSFER_STATE_PAUSED_BY_USER"),J={key:W.entityKey,transferState:X,cotn:g.Cu(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(Y=D)==null?void 0:Y.maximumDownloadQuality,preferredAudioTrack:(v=D)==null?void 0:v.preferredAudioTrack,transferRetryCount:0,isRefresh:x,hasLoggedFirstStarted:!1},g.A(G,Tc(Q.B,
{mode:"readwrite",dG:!0},function(H){var I=[];x&&I.push(Zz(H,g.Mb(K,"offlineVideoStreams")));I.push(fF(H,J,"transfer"));return g.CX.all(I)}),3);
case 3:if(!x){G.kf(4);break}return g.A(G,lHH(K),4);case 4:R$({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:K,t9:J,offlineModeType:(h=k)==null?void 0:h.offlineModeType}),g.VF(G)}})},Y3q=function(Q,W,x,D){if(!Q.action.entityKey)throw Error("entityKey is missing.");
var K=g.jd(Q.action.entityKey);K={entityType:K.Oa,entityId:K.entityId,offlineOrchestrationActionType:Q.action.actionType,orchestrationAction:{orchestrationActionId:Q.actionId}};W&&(K.offlineOrchestrationActionResult=W.status,K.isRetryable=x?!1:W.B,W.D&&(K.offlineOrchestrationFailureReason=uW1(W.D,K.isRetryable)));var l,M;if((l=Q.action.actionMetadata)==null?0:(M=l.offlineLoggingData)==null?0:M.offlineModeType)K.offlineModeType=Q.action.actionMetadata.offlineLoggingData.offlineModeType;D&&(K.additionalOrchestrationActions=
D.map(function(w){return{orchestrationActionId:w.actionId}}));
return K},uW1=function(Q,W){return Q!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||W?Q==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&W?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Q:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},nBq=function(Q,W){var x={offlineOrchestrationContext:Y3q(Q)};
W=$IY(W,x);IiR(BMu(),W,Q.rootActionId)},Vlp=function(Q,W,x,D){D=D===void 0?[]:D;
W={offlineOrchestrationContext:Y3q(Q,W,x,D)};W=$IY(3,W);IiR(BMu(),W,Q.rootActionId)},Pp7=function(){this.actions=[]},vBF=function(Q,W){W=g.V(W);
for(var x=W.next();!x.done;x=W.next())x=x.value,nBq(x,1),Q.actions.push(x);Q.actions.sort(Q.B)},CpY=function(Q,W){if(W)for(var x=0;x<Q.actions.length;x++)if(W==="!*$_ALL_ENTITIES_!*$"&&Q.actions[x].actionId!==W||W!=="!*$_ALL_ENTITIES_!*$"&&Q.actions[x].rootActionId===W&&Q.actions[x].actionId!==W)Q.actions.splice(x,1),x--},J2s=function(Q,W){Q=g.V(Q.actions);
for(var x=Q.next();!x.done;x=Q.next())if(x.value.actionId===W)return!0;return!1},mz=function(Q,W,x,D,K){g.N.call(this);
var l=this;this.U=Q;this.F3=W;this.uj=x;this.G=D;this.bj=K;this.B=new Pp7;this.X=new g.rq;this.D=new g.O3(function(){l.retry()});
this.S=NaN;this.L=!1;this.by={axj:function(){return l.B},
TE:function(){return l.X},
bKt:function(){return l.D},
retry:function(){return l.retry()}};
g.y(this,this.D);this.T=this.U.observe(this.pS.bind(this))},aHp=function(Q,W,x,D,K){var l;
return g.U(function(M){if(M.B==1)return l=new mz(Q,W,x,D,K),g.A(M,ptF(l),2);hpJ(l);return M.return(l)})},hpJ=function(Q){var W=Q.B.actions[0];
return Q.N?((W==null?void 0:W.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Q.N[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Q.L=!0),Promise.resolve()):Gdu(Q)},Gdu=function(Q){var W,x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h;
return g.U(function(G){switch(G.B){case 1:if(Q.N)throw Error("Already processing an action");if(Q.d7())return G.return();W=Q.B.actions.shift();EgR(Q.uj,!W);if(W===void 0)return G.return();W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&W.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&CpY(Q.B,W.actionId);x="";W.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&W.rootActionId===W.actionId&&(x=W.actionId);D=[W];Q.N=D;if(K=Q.F3[W.entityType]){G.kf(2);break}Q.N=
void 0;return g.A(G,Gdu(Q),3);case 3:return G.return();case 2:l=g.V(D);for(M=l.next();!M.done;M=l.next())w=M.value,nBq(w,2);g.P5(G,4,5);return g.A(G,fGJ(K,D.map(function(H){return H.action})),7);
case 7:S=G.U,b=g.V(D),z=b.next();case 8:if(z.done){G.kf(10);break}k=z.value;X=S.get(k.action);return g.A(G,dnJ(Q,k,X),9);case 9:z=b.next();G.kf(8);break;case 10:CpY(Q.B,x);case 5:g.ps(G);Q.N=void 0;g.hv(G,6);break;case 4:return u=g.Jv(G),Dq("Orchestration error",u),g.P5(G,12),g.A(G,i8p(Q,D),14);case 14:g.Cs(G,5);break;case 12:Y=g.Jv(G);Dq("Orchestration retry error",Y);v=g.V(D);for(J=v.next();!J.done;J=v.next())h=J.value,h.retryScheduleIndex<3&&vBF(Q.B,[h]);G.kf(5);break;case 6:return g.A(G,Gdu(Q),
0)}})},dnJ=function(Q,W,x){var D,K,l,M,w,S,b,z,k,X,u,Y;
return g.U(function(v){switch(v.B){case 1:D=W.retryScheduleIndex+2===3;if(x.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){v.kf(2);break}if(x.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){v.kf(0);break}Vlp(W,x,D);if(x.B&&W.retryScheduleIndex+1<3)return g.A(v,i8p(Q,[W]),0);l=((K=x)==null?0:K.U)?x.U:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";M={entityKey:W.action.entityKey,failureReason:l};w=void 0;g.ET(Q.bj)?w="mainVideoDownloadStateEntity":g.Il(Q.bj)&&(w="musicTrackDownloadMetadataEntity");
if(!w||!x.downloadState){v.kf(7);break}S=g.jd(W.action.entityKey).entityId;return g.A(v,z9(S,w,Q.U,x.downloadState),7);case 7:l_(Q.G,M);if(x.downloadState==="DOWNLOAD_STATE_FAILED"&&Q.bj.j("html5_auto_retry_failed_pde_actions")){v.kf(0);break}Dq("Orchestration result is not retryable, deleting action");return g.A(v,ogF(Q.U,ne(W).key),0);case 2:b=void 0;try{b=(z=x.N)==null?void 0:z.map(function(J){return Q.createAction(J,W)})}catch(J){return Vlp(W,x,D),k={entityKey:W.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},l_(Q.G,k),Dq("Orchestration subactions creation error",J),v.return()}Vlp(W,x,D,b);if(!b){v.kf(12);break}X=b.map(function(J){return ne(J)});
u=0;case 13:if(!(u<b.length)||Q.L){v.kf(15);break}return g.A(v,Tc(Q.U,{mode:"readwrite",dG:!0},function(J){var h=[];h.push(jBe(J,X.slice(u,u+10),"offlineOrchestrationActionWrapperEntity"));return g.CX.all(h)}),16);
case 16:u+=10;v.kf(13);break;case 15:if(Q.L)return Q.L=!1,v.return();case 12:return Y=ne(W),g.A(v,ogF(Q.U,Y.key),17);case 17:nBq(W,4),g.VF(v)}})},q3u=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u;
return g.U(function(Y){x=[];D=Infinity;K=4E3;l=g.V(W);for(M=l.next();!M.done;M=l.next())w=M.value,S=Number(w.enqueueTimeSec),b=A21(S),z=w.retryScheduleIndex,k=z!=null&&z>0,b>0&&k?(D=Math.min(D,S),K=Math.min(b,K)):x.push(w);isFinite(D)&&(!Q.D.isActive()||D<Q.S)&&(Q.S=D,Q.D.start(K));Q.X.yv()||(X=x.length,x=x.filter(function(v){var J;v=((J=v.actionProto)==null?void 0:J.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!H81.includes(v)}),u=x.length<X,!Q.D.isActive()&&u&&Q.D.start(1));
x.length>0&&UnH(Q,x);return g.A(Y,hpJ(Q),0)})},$nR=function(Q){var W,x,D,K,l,M,w;
return g.U(function(S){if(S.B==1)return g.A(S,Bxp(Q),2);W=S.U;x=[];D=g.V(W);for(K=D.next();!K.done;K=D.next())l=K.value,M=g.jd(l.key),w=M.entityId,J2s(Q.B,w)||x.push(l);return g.A(S,q3u(Q,x),0)})},A21=function(Q){Q=Q*1E3-Date.now();
return Q>4E3?4E3:Q},i8p=function(Q,W){var x,D,K;
return g.U(function(l){x=g.V(W);for(D=x.next();!D.done;D=x.next()){K=D.value;var M=void 0,w=void 0,S=((w=K.action)==null?void 0:(M=w.actionMetadata)==null?void 0:M.retryScheduleIntervalsInSeconds)||[1,2,4];M=1;K.retryScheduleIndex<S.length&&(M=S[K.retryScheduleIndex]);K.B=M*1E3+Date.now();K.retryScheduleIndex++}return g.A(l,IHe(Q,W),0)})},ptF=function(Q){var W;
return g.U(function(x){if(x.B==1)return g.A(x,FM(Q.U,"offlineOrchestrationActionWrapperEntity"),2);W=x.U;return g.A(x,q3u(Q,W),0)})},UnH=function(Q,W){W.length!==0&&W.forEach(function(x){x=Yr(x);
x.retryScheduleIndex<3&&vBF(Q.B,[x])})},Bxp=function(Q,W){var x;
return g.U(function(D){if(D.B==1)return g.A(D,FM(Q.U,"offlineOrchestrationActionWrapperEntity",W),2);x=D.U;return D.return(x.filter(CqH))})},IHe=function(Q,W){if(W.length===0)return Promise.resolve([]);
W=W.map(function(x){return ne(x)});
return XRJ(Q.U,W)},mnH=function(Q){this.G1=Q;
this.B=void 0},NxC=function(Q,W){var x,D,K,l;
return g.U(function(M){x=W.videoId;D=!0;if(W.captionTracks.length)K=K6H(W),Q.B=new g.CM(Q.G1,W,K);else if(W.kX)l=g.vsF(W),Q.B=new g.pM(Q.G1,W.kX,x,l,W.b$,W.eventId),D=W.b$;else return M.return();return M.return(new Promise(function(w){var S;(S=Q.B)==null||S.Di({vK:function(){return g.U(function(b){if(b.B==1)return g.A(b,Q.vK(x,D),2);w();g.VF(b)})},
rJ:function(){}})}))})},c2p=function(Q){var W;
return g.U(function(x){if(x.B==1)return g.A(x,GJk(Q),2);W=x.U;return x.return(!!W&&W.length>0)})},NV=function(Q){g.N.call(this);
this.B=Q;this.U=this.B.observe(this.D.bind(this))},gB1=function(Q,W){var x,D,K,l,M,w,S;
return g.U(function(b){switch(b.B){case 1:if(W.length===0)return b.return([]);x=W.map(function(z){return g.Mb(z,"transfer")});
return g.A(b,FM(Q.B,"transfer",x),2);case 2:D=b.U;K=D.filter(CqH).map(function(z){return g.jd(z.key).entityId});
l=W.filter(function(z){return K.indexOf(z)===-1});
if(l.length===0)return b.return([]);M=g.V(l);w=M.next();case 3:if(w.done){b.kf(5);break}S=w.value;return g.A(b,lHH(S),4);case 4:w=M.next();b.kf(3);break;case 5:return b.return(l)}})},fHR=function(Q,W,x,D,K,l){var M,w,S;
return g.U(function(b){M="STREAM_TYPE_UNKNOWN";x.video&&x.audio?(M="STREAM_TYPE_AUDIO_AND_VIDEO",Dq("unexpected stream type")):x.video&&!x.audio?M="STREAM_TYPE_VIDEO":!x.video&&x.audio&&(M="STREAM_TYPE_AUDIO");w=g.Mb(W,"offlineVideoStreams");S={numBytesDownloaded:K.toFixed(),numTotalBytes:l.toFixed(),streamType:M,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(D),itag:M==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(x.itag):void 0};return g.A(b,Tc(Q,{mode:"readwrite",dG:!0},
function(z){var k=gU(z,w,"offlineVideoStreams"),X=gU(z,g.Mb(W,"transfer"),"transfer");return g.CX.all([k,X]).then(function(u){u=g.V(u);var Y=u.next().value;u=u.next().value;if(!u)return Zz(z,w).then(function(){});
var v=y2R(Y);Y=epu(Y,D,S,w);var J=fF(z,Y,"offlineVideoStreams");y2R(Y)>v&&(u.lastProgressTimeMs=Date.now().toString());v=[J];u.offlineVideoStreams||(u.offlineVideoStreams=[]);u.offlineVideoStreams.indexOf(w)===-1&&(u.offlineVideoStreams.push(w),v.push(fF(z,u,"transfer")));return g.CX.all(v)})}),0)})},Z87=function(Q,W){var x,D,K,l,M;
return g.U(function(w){if(w.B==1)return x=g.Mb(W,"offlineVideoStreams"),g.A(w,E8(Q,x,"offlineVideoStreams"),2);D=w.U;if(!D||!D.streamsProgress)return w.return();K=g.V(D.streamsProgress);for(l=K.next();!l.done;l=K.next())M=l.value,M.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",M.numTotalBytes!==M.numBytesDownloaded&&(M.numBytesDownloaded=M.numTotalBytes);return g.A(w,O8(Q,D,"offlineVideoStreams"),0)})},epu=function(Q,W,x,D){if(Q&&Q.streamsProgress){D=Q;
a:{W=W.itag+";"+W.xtags;for(var K=Q.streamsProgress,l=0;l<K.length;l++){var M=JSON.parse(K[l].formatStreamBytes);if(M.itag+";"+M.xtags===W){K[l]=x;x=K;break a}}K.push(x);x=K}D.streamsProgress=x}else Q={key:D,streamsProgress:[x]};return Q},y2R=function(Q){if(Q==null?0:Q.streamsProgress){var W=0;
Q=Q.streamsProgress;for(var x=0;x<Q.length;x++){var D=Q[x];isNaN(Number(D.numBytesDownloaded))?Dq("stream progress bytes number invalid"):W+=Number(D.numBytesDownloaded)}return W}return 0},Lip=function(Q,W,x,D){g.N.call(this);
var K=this;this.U=Q;this.api=W;this.eZ=x;this.pS=D;this.X=new g.rq;this.N=new g.O3(function(){K.B&&K.B.transferState==="TRANSFER_STATE_TRANSFERRING"&&K.X.yv()&&((K.B.transferRetryCount||0)<3?I$(K.G,K.L,!1,!1):$r(K.G,K.L.videoDetails.videoId),K.Hl("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.uj=this.fS=0;this.T=this.S=!1;this.s3=g.X0(this.api.C().experiments,"html5_transfer_processing_logs_interval");this.g7=new g.I0(this);this.by={mR7:function(){return K.N},
ONZ:function(){return K.pS},
TE:function(){return K.X}};
this.F3=this.U.observe(this.y0.bind(this));this.G=new KiA(W,this);this.O3=new mnH(W);this.KS=new NV(this.U);this.X3=this.X.listen("publicytnetworkstatus-online",this.Ot.bind(this));this.LS=this.X.listen("publicytnetworkstatus-offline",this.exj.bind(this));this.T=this.api.C().j("html5_less_transfer_processing_logs");g.y(this,this.g7);this.g7.W(W,"offlinetransferpause",this.stj);g.ET(this.api.C())?this.D="mainVideoDownloadStateEntity":g.Il(this.api.C())&&(this.D="musicTrackDownloadMetadataEntity")},
r2C=function(Q){return g.U(function(W){if(W.B==1)W=g.A(W,h4A(),2);
else{var x=Q.KS;var D=g.d0();D=Object.keys(D);x=gB1(x,D);W=g.A(W,x,0)}return W})},gA=function(Q,W){W=W===void 0?!1:W;
var x;return g.U(function(D){if(D.B==1){if(Q.B)throw Error("Already downloading a video");Q.uj=0;Q.S=!1;return g.A(D,Tx5(Q),2)}return D.B!=4?(x=D.U,Ffq(Q.eZ,!x),x&&Q.X.yv()?W?g.A(D,new Promise(function(K){g.oc(K,1E3)}),4):D.kf(4):(!x&&Q.B&&cz(Q),D.kf(0))):g.A(D,O8Y(Q,x),0)})},EBq=function(Q){return g.U(function(W){if(W.B==1)return Q.L?g.A(W,$r(Q.G,Q.L.videoDetails.videoId),3):W.kf(0);
cz(Q);g.VF(W)})},FiA=function(Q,W){var x,D,K;
return g.U(function(l){switch(l.B){case 1:return g.P5(l,2),(x=!!W.captionTracks.length||!!W.kX)?g.A(l,c2p(W.videoId),4):l.return();case 4:return(D=l.U)?l.return():g.A(l,NxC(Q.O3,W),5);case 5:g.Cs(l,0);break;case 2:K=g.Jv(l),Dq("Caption downloading error",K,W.cotn),g.VF(l)}})},O8Y=function(Q,W){var x,D,K,l,M,w;
return g.U(function(S){switch(S.B){case 1:if(Q.S)return S.return();Q.S=!0;Q.B=W;x=g.jd(Q.B.key);D=x.entityId;K=void 0;if(Q.B.transferState==="TRANSFER_STATE_TRANSFERRING")return g.A(S,yG(Q,D),7);if(Q.B.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Q.B.transferRetryCount||Q.B.hasLoggedFirstStarted){S.kf(3);break}return g.A(S,yG(Q,D),5);case 5:return K=S.U,Q.B.hasLoggedFirstStarted=!0,g.A(S,tl7(Q),6);case 6:tZY({videoId:D,t9:Q.B,offlineModeType:K},void 0,void 0,!0);S.kf(3);break;case 7:K=S.U,
R$({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:D,t9:Q.B,offlineModeType:K});case 3:return g.A(S,QrH(Q),8);case 8:return l=null,g.P5(S,9),g.A(S,WSq(Q,W),11);case 11:l=S.U;Q.L=l;g.Cs(S,10);break;case 9:return M=g.Jv(S),Dq("error getting player response",M,W.cotn),g.A(S,Q.Hl("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return S.return();case 10:return w=lGs(Q.api.C(),W.cotn,l),g.A(S,FiA(Q,w),13);case 13:return g.A(S,jbF(w.videoId),
14);case 14:w.QS=S.U,S37(Q.G,w,W.maximumDownloadQuality),Q.N.start(108E5),g.VF(S)}})},Tx5=function(Q){var W,x;
return g.U(function(D){if(D.B==1)return g.A(D,FM(Q.U,"transfer"),2);W=D.U;x=W.filter(xhR).sort(DhC);return x.length===0?D.return():D.return(x[0])})},QrH=function(Q){var W,x,D;
return g.U(function(K){if(K.B==1){if(!Q.B)return eR(Q,"onTransferStart"),K.return();Q.N.start(108E5);return g.A(K,fe(Q,"TRANSFER_STATE_TRANSFERRING"),2)}W=Q.B;return(D=((x=W)==null?0:x.key)?g.jd(W.key).entityId:"")&&Q.D?g.A(K,z9(D,Q.D,Q.U,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):K.kf(0)})},Rpp=function(Q){var W,x,D,K;
g.U(function(l){switch(l.B){case 1:if(!Q.B){eR(Q,"onTransferPausedByUser");l.kf(2);break}W=Q.B;Q.N.stop();return g.A(l,fe(Q,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:D=((x=W)==null?0:x.key)?g.jd(W.key).entityId:"";if(!D||!Q.D){l.kf(4);break}return g.A(l,z9(D,Q.D,Q.U,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.A(l,yG(Q,D),6);case 6:K=l.U,Qve({videoId:D,t9:W,offlineModeType:K});case 2:cz(Q),gA(Q),g.VF(l)}})},wtR=function(Q){var W,x,D;
g.U(function(K){if(K.B==1){if(!Q.B)return eR(Q,"onTransferPausedByNetwork"),K.return();Q.N.stop();return g.A(K,fe(Q,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(K.B!=3)return W=Q.B,(D=((x=W)==null?0:x.key)?g.jd(W.key).entityId:"")&&Q.D?g.A(K,z9(D,Q.D,Q.U,"DOWNLOAD_STATE_PAUSED"),3):K.kf(3);cz(Q);g.VF(K)})},KS7=function(Q){var W,x,D,K,l;
g.U(function(M){switch(M.B){case 1:if(!Q.B)return eR(Q,"onTransferComplete"),M.return();W=Q.B;Q.N.stop();if(!W||!Q.L){M.kf(2);break}x=lGs(Q.api.C(),W.cotn,Q.L);return g.A(M,FiA(Q,x),2);case 2:return g.A(M,fe(Q,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:K=((D=W)==null?0:D.key)?g.jd(W.key).entityId:"";if(!K||!Q.D){M.kf(5);break}return g.A(M,z9(K,Q.D,Q.U,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.A(M,Z87(Q.U,K),7);case 7:return g.A(M,yG(Q,K),8);case 8:l=M.U,R$({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:K,t9:W,offlineModeType:l}),cz(Q),gA(Q),g.VF(M)}})},lER=function(Q,W,x){var D,K;
g.U(function(l){switch(l.B){case 1:if(!Q.B)return eR(Q,"onTransferProgress: "+W),l.return();if(Q.B.transferState==="TRANSFER_STATE_TRANSFERRING"){l.kf(2);break}return g.A(l,QrH(Q),2);case 2:D=Date.now();if(!(D-Q.fS>1E3)){l.kf(4);break}Q.fS=D;return g.A(l,fHR(Q.U,x.videoId,x.U,x.RD,x.bytesDownloaded,x.B),5);case 5:if(Q.T&&!(Q.T&&D-Q.uj>Q.s3)){l.kf(4);break}Q.uj=D;return g.A(l,yG(Q,W),7);case 7:K=l.U,tZY({videoId:W,t9:Q.B,offlineModeType:K},x.bytesDownloaded,x.B);case 4:Q.N.start(108E5),g.VF(l)}})},
jrF=function(Q){var W=(Q.B.transferRetryCount||0)<3;
W&&(Q=Q.B,Q.transferRetryCount=(Q.transferRetryCount||0)+1);return W},M$u=function(Q,W){W=W===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":W;
var x,D,K,l;return g.U(function(M){if(M.B==1)return Q.B||eR(Q,"setTransferToFailed: "+W),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W==="TRANSFER_FAILURE_REASON_NETWORK"?x="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":W==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.A(M,fe(Q,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",W),2);if(M.B!=3)return l_(Q.pS,{entityKey:(D=Q.B)==null?void 0:D.key,failureReason:x}),
K=Q.B?g.jd(Q.B.key).entityId:"",g.A(M,yG(Q,K),3);l=M.U;var w={videoId:K,t9:Q.B,offlineModeType:l},S=W,b={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};S&&(b.transferFailureReason=S,b.failureReason=WbY(S));R$(b,w);g.VF(M)})},fe=function(Q,W,x,D){var K;
return g.U(function(l){if(l.B==1){if(!Q.B)return eR(Q,"saveTransferState: "+W),l.return();Q.B.transferState=W;Q.B.failureReason=D;g.P5(l,2);return g.A(l,tl7(Q,function(M){return x?y6(M,"offlineVideoStreams",Q.B.offlineVideoStreams).then(function(w){for(var S=g.V(w),b=S.next();!b.done;b=S.next())if((b=b.value)&&b.streamsProgress){b=g.V(b.streamsProgress);for(var z=b.next();!z.done;z=b.next())z.value.streamState=x}return jBe(M,w.filter(function(k){return!!k}),"offlineVideoStreams")}):g.CX.resolve(void 0)}),
4)}if(l.B!=2)return g.Cs(l,0);
K=g.Jv(l);return K instanceof g.o8&&K.type==="QUOTA_EXCEEDED"?g.A(l,Q.Hl("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):l.kf(0)})},tl7=function(Q,W){var x;
return g.U(function(D){if(!Q.B)return D.return();x=Q.B;return g.A(D,Tc(Q.U,{mode:"readwrite",dG:!0},function(K){var l=[fF(K,x,"transfer")];W&&l.push(W(K));return g.CX.all(l)}),0)})},cz=function(Q){Q.B=void 0;
Q.L=void 0;Q.N.stop()},WSq=function(Q,W){var x,D,K,l,M;
return g.U(function(w){if(w.B==1)return x=g.jd(W.key),D=x.entityId,K=g.Mb(D,"playbackData"),g.A(w,E8(Q.U,K,"playbackData"),2);l=w.U;if((M=l)==null?0:M.playerResponseJson)return w.return(JSON.parse(l.playerResponseJson));throw Error("No PlayerResponse found");})},eR=function(Q,W){Q.api.qj("woffle",{mcte:W});
Dq("missing current transfer entity.")},yG=function(Q,W){var x,D,K;
return g.U(function(l){if(l.B==1)return g.A(l,E8(Q.U,g.Mb(W,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);x=l.U;return l.return((K=(D=x)==null?void 0:D.offlineModeType)!=null?K:void 0)})},xhR=function(Q){return RQp[Q.transferState]!==void 0},DhC=function(Q,W){var x=RQp[Q.transferState],D=RQp[W.transferState];
return x!==D?x-D:Number(Q.enqueuedTimestampMs)-Number(W.enqueuedTimestampMs)},Zq=function(Q,W){var x=this;
this.bj=Q;this.api=W;this.X=new g.rq;this.L=new g.XT;this.by={Sp:function(){return x.D.by.Sp()},
TE:function(){return x.X},
iNj:function(){return x.D},
dU:function(){return x.dU()},
pc:function(){return x.pc()},
FO:function(){return x.FO()},
N1:function(){return x.N1()},
ya:function(){return x.ya()},
oT:function(D){return x.oT(D)}};
this.D=new rPH(function(){return wgY(x)},function(){x.FO()},this.api.fR(),this.api.j.bind(this.api));
this.B=new Ke(this.api);TMq(this.D)},wgY=function(Q){return g.U(function(W){Q.api.Wt("onOrchestrationBecameLeader");
return g.A(W,Q.pc(),0)})},bTs=function(Q){var W,x;
return g.U(function(D){if(D.B==1)return g.A(D,t9(),2);if(D.B!=3){W=D.U;if(!W)return Dq("PES is undefined"),D.return();Q.U=new Lip(W,Q.api,Q.D,Q.B);x=Q.KT(W);return g.A(D,aHp(W,x,Q.D,Q.B,Q.bj),3)}Q.G=D.U;return g.A(D,SIu(Q),0)})},SIu=function(Q){var W;
return g.U(function(x){switch(x.B){case 1:if(!Q.U)return Dq("transferManager is undefined"),x.return();if(Q.U.B){x.kf(2);break}return g.A(x,gA(Q.U),2);case 2:if(!Q.bj.j("woffle_enable_main_downloads_library")){x.kf(4);break}return g.A(x,Q.uL(),4);case 4:if(!Q.bj.j("html5_offline_playback_position_sync")){x.kf(6);break}return g.A(x,Q.dS(),7);case 7:return g.A(x,Q.oT(864E5),6);case 6:return g.A(x,Q.refreshAllStaleEntities(43200,!0),9);case 9:return g.A(x,Q.M$(),10);case 10:if(!Q.bj.j("html5_retry_downloads_for_expiration")){x.kf(11);
break}return g.A(x,Q.ya(),11);case 11:return Q.S=g.uY(function(){Q.refreshAllStaleEntities(43200,!0);Q.M$()},9E5),g.Fw(g.QX(),function(){return Q.N1()}),g.A(x,t9(),13);
case 13:return W=x.U,g.A(x,LfC(W),14);case 14:Opk(Q.D),g.VF(x)}})},srF=function(){var Q,W,x,D,K,l;
return g.U(function(M){switch(M.B){case 1:return g.A(M,t9(),2);case 2:Q=M.U;if(!Q)return M.return([]);W=Date.now()/1E3;return g.A(M,FM(Q,"offlineVideoPolicy"),3);case 3:x=M.U,D=g.V(x),K=D.next();case 4:if(K.done){M.kf(6);break}l=K.value;if(!(l.expirationTimestamp&&Number(l.expirationTimestamp)<W)){M.kf(5);break}l.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";l.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.A(M,O8(Q,l,"offlineVideoPolicy"),5);
case 5:K=D.next();M.kf(4);break;case 6:return M.return(x.map(function(w){return w.key}))}})},Le=function(Q,W,x,D,K){var l,M,w;
return g.U(function(S){if(S.B==1)return g.A(S,t9(),2);l=S.U;if(!l)return S.return([]);M=W.map(function(b){var z=g.Mb(b,x);z={actionType:D,entityKey:z,actionMetadata:Object.assign({},jvY(),K)};D!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(z.actionMetadata.priority=0);b=new u_(x,b,z);return ne(b)});
w=XRJ(l,M);TMq(Q.D);return S.return(w)})},zQJ=function(Q,W,x,D){var K,l,M,w,S,b,z,k;
return g.U(function(X){switch(X.B){case 1:K=[],l=g.V(W),M=l.next();case 2:if(M.done){X.kf(4);break}w=M.value;if(w.upToDate||x&&!w.shouldAutoSyncMetadata||!w.playlistId){X.kf(3);break}S={};switch(D){case "mainPlaylistEntity":b={nextAutoRefreshIntervalSeconds:w.checkInSeconds,autoSync:x};S={mainPlaylistEntityActionMetadata:b};break;case "musicPlaylist":z={autoSync:x},S={musicPlaylistEntityActionMetadata:z}}return g.A(X,Le(Q,[w.playlistId],D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S),6);case 6:(k=
X.U)&&K.push.apply(K,g.C(k));case 3:M=l.next();X.kf(2);break;case 4:return X.return(K)}})},kyp=function(Q,W){var x;
return g.U(function(D){return W.length?(x=jvY(),g.cp(x,qV,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Q.api.qj("qrd",{v:W.length}),D.return(Le(Q,W,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x))):D.return([])})},XgH=function(Q,W,x){this.B=Q;
this.bj=W;this.D=x},YI7=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G;
return g.U(function(H){switch(H.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,l=[],g.P5(H,2),g.A(H,oR5(Q,K),4);case 4:l=H.U;if(!(Q.bj.j("woffle_enable_main_downloads_library")&&((M=l)==null?0:M.length))){H.kf(5);break}return g.A(H,nk1(Q.B,[W.entityKey]),5);case 5:g.Cs(H,3);break;case 2:return w=g.Jv(H),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.o8&&w.type==="QUOTA_EXCEEDED"?(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Dq("Playlist add error"),H.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,S,b));case 3:z=[];if(!Q.bj.j("html5_offline_prevent_redownload_downloaded_video")){H.kf(7);break}return g.A(H,Kbs(Q.B,"mainVideoEntity",l),8);case 8:l=H.U;case 7:if((k=l)==null?0:k.length)for(X=g.V(l),u=X.next();!u.done;u=X.next())if(Y=u.value,v=Y.offlineVideoData,J=void 0,(J=v)==null?0:J.videoId)h=void 0,G=Number(((h=W.actionMetadata)==null?void 0:h.priority)||
0)+1,z.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",v.videoId,"mainVideoEntity",G,rA,uKe(W,v,K)));return H.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,z))}})},V$A=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d,q,m,W5,l2,jn,B,b2,o1,w4,Av,XH,Nk,k8,fs,c1,SE,H6,fC,SD,eh,gl,fy,Vz,b0,H_,kV,U7,U1,qM,hG,tm,Zf,KP,C8,mg;
return g.U(function(Xf){switch(Xf.B){case 1:return x=wA(W),D=W.entityKey,K=g.jd(D).entityId,l=[],M=!1,K==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.A(Xf,FM(Q.B,"mainPlaylistEntity"),5)):g.A(Xf,E8(Q.B,D,"mainPlaylistEntity"),4);case 4:(w=Xf.U)&&l.push(w);Xf.kf(3);break;case 5:l=Xf.U;case 3:if((S=l)==null||!S.length)return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.e(W.actionMetadata,nR5);k=(z=b)==null?void 0:z.nextAutoRefreshIntervalSeconds;u=(X=b)==null?void 0:X.autoSync;Y=[];J=v=
!0;h=!1;if(!M&&u===!1){Xf.kf(6);break}g.P5(Xf,7);return g.A(Xf,U7J(0,!!u,!0,l),9);case 9:Y=Xf.U;g.Cs(Xf,8);break;case 7:G=g.Jv(Xf);if(!(G instanceof Error&&G.message==="No data")){G instanceof Error&&G.message==="Empty response body"&&Dq(G.message);Xf.kf(8);break}return K==="!*$_ALL_ENTITIES_!*$"?g.A(Xf,zb1(Q.B,W,Q.D,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.A(Xf,bZs(K,Q.B,W,Q.D),8);case 8:if(!Y.length||!M&&Y[0].playlistId!==K)return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));case 6:if(M){H=[];I=g.V(Y);for(c=I.next();!c.done;c=I.next())O=c.value,O.upToDate||u&&!O.shouldAutoSyncMetadata||!O.playlistId||(T={nextAutoRefreshIntervalSeconds:O.checkInSeconds,autoSync:u},H.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O.playlistId,"mainPlaylistEntity",0,rA,{mainPlaylistEntityActionMetadata:T})));return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,H))}Y.length&&(Ks=Y[0],h=!!Ks.upToDate,u&&(v=(Mz=Ks.shouldAutoSyncMetadata)!=null?Mz:!0,J=(QF=Ks.shouldAutoSyncVideos)!=
null?QF:!0,Ks.checkInSeconds&&(k=Ks.checkInSeconds)));if(h||!v)return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));f=[];t=l[0];if(!t.downloadState){P=void 0;Xf.kf(15);break}return g.A(Xf,E8(Q.B,t.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:P=Xf.U;case 15:return Z=P,vu=((c5=Z)==null?0:c5.addedTimestampMillis)?String(Z.addedTimestampMillis):void 0,g.P5(Xf,17),g.A(Xf,oR5(Q,K,vu,k),19);case 19:f=Xf.U;g.Cs(Xf,18);break;case 17:kF=g.Jv(Xf);if(!(kF instanceof Error&&
kF.message==="No data for playlist")){if(kF instanceof Error&&kF.message==="Empty response body for playlist")Dq(kF.message);else return a1="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",El="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kF instanceof g.o8&&kF.type==="QUOTA_EXCEEDED"&&(a1="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",El="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,a1,El));Xf.kf(18);
break}return g.A(Xf,bZs(K,Q.B,W,Q.D),18);case 18:if(!J)return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));D7=[];uC=new Map;if((p=f)==null?0:p.length)for(a=g.V(f),d=a.next();!d.done;d=a.next())q=d.value,m=q.offlineVideoData,W5=void 0,((W5=m)==null?0:W5.videoId)&&uC.set(m.videoId,m);l2=new Map;jn=[];if((B=t)==null?0:(b2=B.videos)==null?0:b2.length)for(o1=g.V(t.videos),w4=o1.next();!w4.done;w4=o1.next())if(Av=w4.value,XH=JSON.parse(g.jd(Av).entityId),Nk=XH.videoId)uC.has(Nk)?(l2.set(Nk,
uC.get(Nk)),uC.delete(Nk)):jn.push(Nk);fs=Number(((k8=W.actionMetadata)==null?void 0:k8.priority)||0)+1;c1=g.V(uC.entries());for(SE=c1.next();!SE.done;SE=c1.next())H6=SE.value,fC=g.V(H6),SD=fC.next().value,eh=fC.next().value,gl=SD,fy=eh,D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",gl,"mainVideoEntity",fs,rA,uKe(W,fy,K)));Vz=g.V(l2.entries());for(b0=Vz.next();!b0.done;b0=Vz.next())H_=b0.value,kV=g.V(H_),U7=kV.next().value,U1=kV.next().value,qM=U7,hG=U1,D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
qM,"mainVideoEntity",fs,rA,uKe(W,hG,K)));tm=g.V(jn);for(Zf=tm.next();!Zf.done;Zf=tm.next())KP=Zf.value,C8={playlistId:K},mg={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:C8},D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",KP,"mainVideoEntity",0,rA,mg));return Xf.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,D7))}})},PfF=function(Q,W){var x,D,K,l;
return g.U(function(M){switch(M.B){case 1:return x=wA(W),g.P5(M,2),D=g.jd(W.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.A(M,zb1(Q.B,W,Q.D,(K=W.actionMetadata)==null?void 0:(l=K.offlineLoggingData)==null?void 0:l.offlineDeleteReason),5):g.A(M,bZs(D,Q.B,W,Q.D),6);case 6:if(!Q.bj.j("woffle_enable_main_downloads_library")){M.kf(5);break}return g.A(M,VO1(Q.B,W.entityKey),5);case 5:g.Cs(M,3);break;case 2:return g.Jv(M),M.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},oR5=function(Q,W,x,D){var K,l,M,w,S,b,z;
return g.U(function(k){switch(k.B){case 1:return g.A(k,AHJ([W]),2);case 2:return K=k.U,g.A(k,vRs(Q,K[0],x,D),3);case 3:return l=k.U,M=l.mainPlaylistEntity,w=l.Oej,b=wFu(M,(S=w)==null?void 0:S.avatar),g.P5(k,4),g.A(k,Pz(b),6);case 6:g.Cs(k,5);break;case 4:z=g.Jv(k),z instanceof Error&&z.message==="Failed to fetch"&&Dq(z.message);case 5:return k.return(K[0].videos)}})},vRs=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I;
return g.U(function(c){switch(c.B){case 1:K=Date.now().toString();x||(x=K);l=W.videos;M=W.playlistId;w=[];S=[];if(l)for(b=g.V(l),z=b.next();!z.done;z=b.next()){k=z.value;X=k.offlineVideoData;if(!X||!X.videoId)throw Dq("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");u=X.videoId;Y={videoId:u,playlistId:M};v={id:g.Mb(JSON.stringify(Y),"mainPlaylistVideoEntity"),video:g.Mb(u,"mainVideoEntity")};w.push(v);S.push(v.id)}h={key:g.Mb(M,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:x,lastSyncedTimestampMillis:K};G={key:g.Mb(M,"mainPlaylistEntity"),playlistId:M,videos:S,title:W.title,thumbnailStyleData:Cf7(W),visibility:JUY(W),downloadState:h.key};W.channel&&(H=W.channel.offlineChannelData,J=pgq(g.Mb(M,"ytMainChannelEntity"),H),G.channelOwner=J.id);((I=G)==null?0:I.entityMetadata)?(G.entityMetadata.offlineLastModifiedTimestampSeconds=W.lastModifiedTimestamp,D&&(G.entityMetadata.nextAutoRefreshIntervalSeconds=String(D))):G&&(G.entityMetadata={nextAutoRefreshIntervalSeconds:D?
String(D):void 0,offlineLastModifiedTimestampSeconds:W.lastModifiedTimestamp});g.P5(c,2);return g.A(c,Tc(Q.B,{mode:"readwrite",dG:!0},function(O){var T=fF(O,G,"mainPlaylistEntity"),Ks=fF(O,h,"mainPlaylistDownloadStateEntity");T=[T,Ks];Ks=g.V(w);for(var Mz=Ks.next();!Mz.done;Mz=Ks.next())T.push(fF(O,Mz.value,"mainPlaylistVideoEntity"));J&&T.push(fF(O,J,"ytMainChannelEntity"));return g.CX.all(T)}),4);
case 4:g.Cs(c,3);break;case 2:throw g.Jv(c),Dq("PES failure for playlist"),Error("PES failure for playlist");case 3:return c.return({mainPlaylistEntity:G,Oej:J,xc1:w})}})},pgq=function(Q,W){return{id:Q,
channelId:W.channelId,title:W.title,avatar:W.thumbnail}},Cf7=function(Q){var W=[],x=Q.videos;
x&&x.length>0&&W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:x[0].offlineVideoData.thumbnail}}});if((Q=Q.additionalMetadadatas)&&Q.length>0)for(Q=g.V(Q),x=Q.next();!x.done;x=Q.next()){var D=x.value.offlineBundleItemPlaylistData,K=void 0;x=(K=D)==null?void 0:K.style;K=void 0;D={collageThumbnail:{coverThumbnail:(K=D)==null?void 0:K.coverThumbnail}};switch(x){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:D});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":W.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:D})}}return W},JUY=function(Q){switch(Q.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},uKe=function(Q,W,x){W={offlineVideoData:W,
playlistId:x};if(Q=g.e(Q.actionMetadata,nR5))W.maximumDownloadQuality=Q.maximumDownloadQuality;return{mainVideoEntityActionMetadata:W}},hQC=function(Q,W,x){this.B=Q;
this.bj=W;this.D=x},dhu=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y;
return g.U(function(v){switch(v.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,l=g.e(W.actionMetadata,T9),w=!((M=l)==null?0:M.playlistId),g.P5(v,2),g.A(v,aEs(Q,K,void 0,(S=l)==null?void 0:S.offlineVideoData,w),4);case 4:g.Cs(v,3);break;case 2:return b=g.Jv(v),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.o8&&b.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,z,k));case 3:X=1;X=Number(((u=W.actionMetadata)==null?void 0:u.priority)||0)+1;var J=(J=g.e(W.actionMetadata,T9))?{playbackDataActionMetadata:{maximumDownloadQuality:J.maximumDownloadQuality}}:void 0;Y=Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"playbackData",X,Gy5,J);return v.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,[Y]))}})},iTC=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G;
return g.U(function(H){switch(H.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,g.A(H,E8(Q.B,W.entityKey,"mainVideoEntity"),2);case 2:l=H.U;if(!l){M=void 0;H.kf(3);break}return g.A(H,E8(Q.B,l.downloadState,"mainVideoDownloadStateEntity"),4);case 4:M=H.U;case 3:w=M;if(!l||!w)return H.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));g.P5(H,5);return g.A(H,aEs(Q,K,w.addedTimestampMillis,(b=g.e(W.actionMetadata,T9))==null?void 0:b.offlineVideoData),7);case 7:z=1;z=Number(((k=
W.actionMetadata)==null?void 0:k.priority)||0)+1;S=Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K,"playbackData",z,Gy5);g.Cs(H,6);break;case 5:X=g.Jv(H);if(!(X instanceof Error&&X.message==="No data")){if(X instanceof Error&&X.message==="Empty response body")Dq(X.message);else return u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",X instanceof g.o8&&X.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,u,Y));H.kf(6);break}return g.A(H,JM(Q.B,K),9);case 9:v=H.U;J=g.e(W.actionMetadata,T9);if(G=(h=J)==null?void 0:h.playlistId)v.playlistId=G;v.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.A(H,vz(K,Q.B,W,Q.D,v),6);case 6:return H.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,S?[S]:void 0))}})},AUF=function(Q,W){var x,D,K,l,M,w,S,b,z,k;
return g.U(function(X){switch(X.B){case 1:return x=wA(W),g.P5(X,2),D=g.jd(W.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.A(X,zb1(Q.B,W,Q.D,(z=W.actionMetadata)==null?void 0:(k=z.offlineLoggingData)==null?void 0:k.offlineDeleteReason),5):g.A(X,JM(Q.B,D),6);case 6:K=X.U;l=g.e(W.actionMetadata,T9);if(w=(M=l)==null?void 0:M.playlistId)K.playlistId=w;K.offlineDeleteReason=(S=W.actionMetadata)==null?void 0:(b=S.offlineLoggingData)==null?void 0:b.offlineDeleteReason;return g.A(X,vz(D,Q.B,W,Q.D,K),7);
case 7:if(!Q.bj.j("woffle_enable_main_downloads_library")){X.kf(5);break}return g.A(X,VO1(Q.B,W.entityKey),5);case 5:g.Cs(X,3);break;case 2:return g.Jv(X),X.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x))}})},aEs=function(Q,W,x,D,K){var l,M,w,S,b,z;
return g.U(function(k){switch(k.B){case 1:if(l=D){k.kf(2);break}return g.A(k,iZC([W]),3);case 3:M=k.U,l=M[0];case 2:return g.A(k,HTu(Q,l,x,K),4);case 4:w=k.U;S=w.mainVideoEntity;b=w.channelEntity;g.P5(k,5);var X=o$(S.thumbnail),u=o$(b.avatar);return g.A(k,Pz(X.concat(u)),7);case 7:g.Cs(k,0);break;case 5:z=g.Jv(k),z instanceof Error&&z.message==="Failed to fetch"&&Dq(z.message),g.VF(k)}})},HTu=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X,u,Y,v,J;
return g.U(function(h){switch(h.B){case 1:x||(x=Date.now().toString());l=(K=W.channel)==null?void 0:K.offlineChannelData;M={id:g.Mb(W.videoId,"ytMainChannelEntity"),channelId:l.channelId,title:l.title,avatar:l.thumbnail};w={key:g.Mb(W.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Mb(W.videoId,"playbackData"),addedTimestampMillis:x,videoDownloadContextEntity:g.Mb(W.videoId,"videoDownloadContextEntity")};S={key:g.Mb(W.videoId,"videoPlaybackPositionEntity"),videoId:W.videoId,lastPlaybackPositionSeconds:"0"};
Q.bj.j("html5_offline_playback_position_sync")&&(b={playbackPosition:S.key});z=g.Mb(W.videoId,"mainVideoEntity");k={key:z,videoId:W.videoId,title:W.title,thumbnail:W.thumbnail,localizedStrings:{viewCount:W.shortViewCountText},userState:b,lengthSeconds:W.lengthSeconds?Number(W.lengthSeconds):void 0,publishedTimestampMillis:W.publishedTimestamp?(Number(W.publishedTimestamp)*1E3).toString():void 0,formattedDescription:W.description,owner:M.id,downloadState:w.key};if(!Q.bj.j("woffle_enable_main_downloads_library")||
!D){h.kf(2);break}return g.A(h,Yap(Q.B,[z]),3);case 3:if(Y=h.U)X=Y.mainDownloadsLibraryEntity,u=Y.mainDownloadsListEntity;case 2:return J=D7k,v={key:g.Mb(W.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.cp(w,J,v),g.A(h,Tc(Q.B,{mode:"readwrite",dG:!0},function(G){var H=fF(G,M,"ytMainChannelEntity"),I=fF(G,w,"mainVideoDownloadStateEntity"),c=fF(G,k,"mainVideoEntity");H=[H,I,c];Q.bj.j("html5_offline_playback_position_sync")&&(I=fF(G,S,"videoPlaybackPositionEntity"),
H.push(I));X&&(I=fF(G,X,"mainDownloadsLibraryEntity"),H.push(I));u&&(I=fF(G,u,"mainDownloadsListEntity"),H.push(I));v&&(G=fF(G,v,"downloadStatusEntity"),H.push(G));return g.CX.all(H)}),4);
case 4:return h.return({mainVideoEntity:k,channelEntity:M})}})},UhA=function(Q,W,x){this.B=Q;
this.bj=W;this.D=x},Bks=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t;
return g.U(function(P){switch(P.B){case 1:return x=wA(W),D=[],g.A(P,m8.getInstance(),2);case 2:K=P.U;if(!K){P.kf(3);break}return g.A(P,K.get("sdois"),4);case 4:return l=P.U,g.A(P,(w=K)==null?void 0:w.get("lmqf"),5);case 5:M=P.U;case 3:g.P5(P,6);if(l===void 0)throw Error("prefStorage or opt-in state is undefined");S=[];if(l){P.kf(8);break}return g.A(P,uZR(Q.B),9);case 9:S=P.U,S.reverse();case 8:if(!S.length){P.kf(10);break}b=g.V(S);z=b.next();case 11:if(z.done){P.kf(10);break}k=z.value;if(!k){P.kf(12);
break}X=g.jd(k).entityId;return g.A(P,JM(Q.B,X),14);case 14:return u=P.U,u.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.A(P,vz(X,Q.B,{entityKey:k,actionType:W.actionType},Q.D,u),12);case 12:z=b.next();P.kf(11);break;case 10:return g.A(P,BJ5(l,(Y=M)!=null?Y:"SD"),16);case 16:return v=P.U,g.A(P,kNA(v),17);case 17:J=okF(v);if(!Q.bj.j("woffle_enable_main_downloads_library")){P.kf(18);break}if(l){P.kf(19);break}return g.A(P,VO1(Q.B,g.UK),19);case 19:return g.A(P,nk1(Q.B,[g.UK]),18);
case 18:if((h=J)==null?0:h.length)for(G=g.V(J),H=G.next();!H.done;H=G.next())if(c=I=H.value,O=c.actionType,T=c.entityKey,Ks=c.actionMetadata,O&&T&&Ks&&!g.e(Ks,qIs)){O==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Ks.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Mz=g.e(I.actionMetadata,T9))Mz.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",I.actionMetadata=Object.assign({},I.actionMetadata,{mainVideoEntityActionMetadata:Mz});D.push(I)}g.Cs(P,7);break;
case 6:return QF=g.Jv(P),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",QF instanceof g.o8&&QF.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),P.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,f,t));case 7:return P.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,D))}})},$hH=function(){Zq.apply(this,arguments);
this.T="mainVideoEntity"},IEY=function(Q,W,x){W=W===void 0?43200:W;
x=x===void 0?!0:x;var D=D===void 0?!1:D;var K,l,M;return g.U(function(w){switch(w.B){case 1:if(!Q.X.yv())return w.return([]);K=[];g.P5(w,2);return g.A(w,U7J(W,x,D),4);case 4:K=w.U;g.Cs(w,3);break;case 2:l=g.Jv(w),l instanceof Error&&l.message==="No data"||l instanceof Error&&l.message==="Empty response body"&&Dq(l.message);case 3:return M=zQJ(Q,K,x,"mainPlaylistEntity"),w.return(M)}})},mhs=function(Q,W,x,D){D=D===void 0?!1:D;
var K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G;return g.U(function(H){switch(H.B){case 1:return K=[],g.A(H,qap(),2);case 2:return(l=H.U)||D?g.A(H,$7k(W,x),3):H.return([]);case 3:M=H.U;if((w=M)==null||!w.length)return H.return([]);S={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};b=g.V(M);z=b.next();case 4:if(z.done){H.kf(6);break}X=k=z.value;u=X.actionType;Y=X.entityKey;v=X.actionMetadata;if(!(u&&Y&&v)||g.e(v,qIs)){H.kf(5);break}u==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(v.offlineLoggingData=
S);J=g.jd(Y);h=J.entityId;return g.A(H,Le(Q,[h],"mainVideoEntity",u,v),8);case 8:G=H.U,K=K.concat(G);case 5:z=b.next();H.kf(4);break;case 6:return H.return(K)}})},NkJ=function(Q,W){this.B=Q;
this.D=W},gRR=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h;
return g.U(function(G){switch(G.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,l=[],g.P5(G,2),g.A(G,cUR(Q,K),4);case 4:l=G.U;if((M=l)==null||!M.length){G.kf(5);break}return g.A(G,pFe(Q.B,W.entityKey),5);case 5:g.Cs(G,3);break;case 2:return w=g.Jv(G),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.o8&&w.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,S,b));case 3:return z=[],g.A(G,Kbs(Q.B,"musicTrack",l),7);case 7:l=G.U;if(l.length)for(k=g.V(l),X=k.next();!X.done;X=k.next())if(u=X.value,Y=u.offlineVideoData,v=void 0,(v=Y)==null?0:v.videoId)J=void 0,h=Number(((J=W.actionMetadata)==null?void 0:J.priority)||0)+1,z.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"musicTrack",h,O4,G9(W,Y,K)));return G.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,z))}})},
yUR=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d,q,m,W5,l2,jn,B,b2,o1,w4,Av,XH,Nk,k8,fs,c1,SE,H6,fC,SD,eh;
return g.U(function(gl){switch(gl.B){case 1:return x=wA(W),D=W.entityKey,K=g.jd(D).entityId,l=[],M=!1,K==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.A(gl,FM(Q.B,"musicAlbumRelease"),5)):g.A(gl,E8(Q.B,D,"musicAlbumRelease"),4);case 4:(w=gl.U)&&l.push(w);gl.kf(3);break;case 5:l=gl.U;case 3:if((S=l)==null||!S.length)return gl.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));if(M){b=[];z=g.V(l);for(k=z.next();!k.done;k=z.next())X=k.value,u=g.jd(X.id).entityId,b.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
u,"musicAlbumRelease",0,O4));return gl.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,b))}Y=[];v=l[0];J=void 0;if(!v.downloadMetadata){gl.kf(6);break}return g.A(gl,E8(Q.B,v.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:h=gl.U,J=Number((H=(G=h)==null?void 0:G.addedTimestampMillis)!=null?H:"0")/1E3;case 6:return g.P5(gl,8),g.A(gl,cUR(Q,K,(I=J)==null?void 0:I.toString()),10);case 10:Y=gl.U;g.Cs(gl,9);break;case 8:c=g.Jv(gl);if(!(c instanceof Error&&c.message===
"No data")){if(c instanceof Error&&c.message==="Empty response body")Dq(c.message);else return O="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.o8&&c.type==="QUOTA_EXCEEDED"&&(O="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),gl.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,O,T));gl.kf(9);break}return g.A(gl,hM(K,"musicAlbumRelease",Q.B,
W,Q.D),9);case 9:Ks=[];Mz=new Map;if((QF=Y)==null?0:QF.length)for(f=g.V(Y),t=f.next();!t.done;t=f.next())P=t.value,Z=P.offlineVideoData,c5=void 0,((c5=Z)==null?0:c5.videoId)&&Mz.set(Z.videoId,Z);vu=new Map;kF=[];if((a1=v)==null?0:(El=a1.tracks)==null?0:El.length)for(D7=g.V(v.tracks),uC=D7.next();!uC.done;uC=D7.next())if(p=uC.value,a=g.jd(p).entityId)Mz.has(a)?(vu.set(a,Mz.get(a)),Mz.delete(a)):kF.push(a);q=Number(((d=W.actionMetadata)==null?void 0:d.priority)||0)+1;m=g.V(Mz.entries());for(W5=m.next();!W5.done;W5=
m.next())l2=W5.value,jn=g.V(l2),B=jn.next().value,b2=jn.next().value,o1=B,w4=b2,Ks.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",o1,"musicTrack",q,O4,G9(W,w4)));Av=g.V(vu.entries());for(XH=Av.next();!XH.done;XH=Av.next())Nk=XH.value,k8=g.V(Nk),fs=k8.next().value,c1=k8.next().value,SE=fs,H6=c1,Ks.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",SE,"musicTrack",q,O4,G9(W,H6)));fC=g.V(kF);for(SD=fC.next();!SD.done;SD=fC.next())eh=SD.value,Ks.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",eh,
"musicTrack",0,O4));return gl.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,Ks))}})},eQA=function(Q,W){var x,D;
return g.U(function(K){switch(K.B){case 1:return x=wA(W),g.P5(K,2),D=g.jd(W.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.A(K,a$(Q.B,W,Q.D),5):g.A(K,hM(D,"musicAlbumRelease",Q.B,W,Q.D),6);case 6:return g.A(K,hbA(Q.B,W.entityKey),5);case 5:g.Cs(K,3);break;case 2:return g.Jv(K),K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},cUR=function(Q,W,x){var D,K,l;
return g.U(function(M){switch(M.B){case 1:return g.A(M,AHJ([W]),2);case 2:return D=M.U,g.A(M,fEJ(Q,D[0],x),3);case 3:return K=M.U,l=o$(K.thumbnailDetails),g.A(M,Pz(l),4);case 4:return M.return(D[0].videos)}})},fEJ=function(Q,W,x){var D,K,l,M,w,S,b,z,k,X,u,Y,v,J;
return g.U(function(h){if(h.B==1){D=W.additionalMetadadatas;K=void 0;if(D&&D.length>0)for(l=g.V(D),M=l.next();!M.done;M=l.next())if(w=M.value,w.offlineMusicPlaylistData){K=w.offlineMusicPlaylistData;break}S=W.playlistId;b=aG7(W);z=b.mK;k=b.UE;X=x?(Number(x)*1E3).toString():Date.now().toString();u=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0";Y={id:g.Mb(S,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:k,lastModifiedTimestampMillis:u,addedTimestampMillis:X,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};v={id:g.Mb(S,"musicAlbumRelease"),title:W.title,audioPlaylistId:S,trackCount:W.totalVideoCount,tracks:z,downloadMetadata:Y.id};K&&(v.thumbnailDetails=(J=K.albumHqThumbnail)!=null?J:K.albumArtistThumbnail,v.artistDisplayName=K.albumArtistDisplayName,v.releaseDate=K.albumReleaseDate,v.contentRating={explicitType:K.albumReleaseExplicitType},v.releaseType=K.albumReleaseType);return g.A(h,Tc(Q.B,{mode:"readwrite",dG:!0},function(G){var H=fF(G,v,"musicAlbumRelease");
G=fF(G,Y,"musicAlbumReleaseDownloadMetadataEntity");return g.CX.all([H,G])}),2)}return h.return(v)})},ZTp=function(Q,W){this.B=Q;
this.D=W},rUC=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h;
return g.U(function(G){switch(G.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,l=[],g.P5(G,2),g.A(G,LS7(Q,K),4);case 4:l=G.U;if((M=l)==null||!M.length){G.kf(5);break}return g.A(G,pFe(Q.B,W.entityKey),5);case 5:g.Cs(G,3);break;case 2:return w=g.Jv(G),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.o8&&w.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
G.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,S,b));case 3:return z=[],g.A(G,Kbs(Q.B,"musicTrack",l),7);case 7:l=G.U;if(l.length)for(k=g.V(l),X=k.next();!X.done;X=k.next())if(u=X.value,Y=u.offlineVideoData,v=void 0,(v=Y)==null?0:v.videoId)J=void 0,h=Number(((J=W.actionMetadata)==null?void 0:J.priority)||0)+1,z.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"musicTrack",h,E4,G9(W,Y,K)));return G.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,z))}})},
Tks=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC,p,a,d,q,m,W5,l2,jn,B,b2,o1,w4,Av,XH,Nk,k8,fs,c1,SE,H6,fC,SD,eh,gl,fy,Vz,b0,H_,kV,U7,U1,qM,hG,tm,Zf;
return g.U(function(KP){switch(KP.B){case 1:return x=wA(W),D=W.entityKey,K=g.jd(D).entityId,l=[],M=!1,K==="!*$_ALL_ENTITIES_!*$"?(M=!0,g.A(KP,FM(Q.B,"musicPlaylist"),5)):g.A(KP,E8(Q.B,D,"musicPlaylist"),4);case 4:(w=KP.U)&&l.push(w);KP.kf(3);break;case 5:l=KP.U;case 3:if((S=l)==null||!S.length)return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.e(W.actionMetadata,GNH);k=(z=b)==null?void 0:z.autoSync;X=[];Y=u=!0;v=!1;J=void 0;if(!M&&k===!1){KP.kf(6);break}g.P5(KP,7);return g.A(KP,
IGs(0,!!k,!0,l),9);case 9:X=KP.U;g.Cs(KP,8);break;case 7:h=g.Jv(KP);if(!(h instanceof Error&&h.message==="No data")){h instanceof Error&&h.message==="Empty response body"&&Dq(h.message);KP.kf(8);break}return K==="!*$_ALL_ENTITIES_!*$"?g.A(KP,a$(Q.B,W,Q.D),8):g.A(KP,hM(K,"musicPlaylist",Q.B,W,Q.D),8);case 8:if(!X.length||!M&&X[0].playlistId!==K)return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));case 6:if(M){G=[];H=g.V(X);for(I=H.next();!I.done;I=H.next())c=I.value,c.upToDate||
k&&!c.shouldAutoSyncMetadata||!c.playlistId||(O={autoSync:k},G.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c.playlistId,"musicPlaylist",0,E4,{musicPlaylistEntityActionMetadata:O})));return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,G))}X.length&&(T=X[0],v=!!T.upToDate,k&&(u=(Ks=T.shouldAutoSyncMetadata)!=null?Ks:!0,Y=(Mz=T.shouldAutoSyncVideos)!=null?Mz:!0,T.checkInSeconds&&(J=T.checkInSeconds)));if(v||!u)return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));QF=[];f=l[0];t=void 0;if(!f.downloadMetadata){KP.kf(15);break}return g.A(KP,E8(Q.B,f.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:P=KP.U,t=Number((c5=(Z=P)==null?void 0:Z.addedTimestampMillis)!=null?c5:"0")/1E3;case 15:return g.P5(KP,17),g.A(KP,LS7(Q,K,(vu=t)==null?void 0:vu.toString(),J),19);case 19:QF=KP.U;g.Cs(KP,18);break;case 17:kF=g.Jv(KP);if(!(kF instanceof Error&&kF.message==="No data")){if(kF instanceof Error&&kF.message==="Empty response body")Dq(kF.message);else return a1=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",El="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",kF instanceof g.o8&&kF.type==="QUOTA_EXCEEDED"&&(a1="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",El="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,a1,El));KP.kf(18);break}return g.A(KP,hM(K,"musicPlaylist",Q.B,W,Q.D),18);case 18:if(!Y)return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x));D7=[];uC=new Map;if((p=QF)==null?0:p.length)for(a=g.V(QF),d=a.next();!d.done;d=a.next())q=d.value,m=q.offlineVideoData,W5=void 0,((W5=m)==null?0:W5.videoId)&&uC.set(m.videoId,m);l2=new Map;jn=[];if((B=f)==null?0:(b2=B.tracks)==null?0:b2.length)for(o1=g.V(f.tracks),w4=o1.next();!w4.done;w4=o1.next())if(Av=w4.value,XH=g.jd(Av).entityId)uC.has(XH)?(l2.set(XH,uC.get(XH)),uC.delete(XH)):jn.push(XH);k8=Number(((Nk=W.actionMetadata)==null?void 0:Nk.priority)||0)+1;fs=g.V(uC.entries());for(c1=fs.next();!c1.done;c1=
fs.next())SE=c1.value,H6=g.V(SE),fC=H6.next().value,SD=H6.next().value,eh=fC,gl=SD,D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",eh,"musicTrack",k8,E4,G9(W,gl)));fy=g.V(l2.entries());for(Vz=fy.next();!Vz.done;Vz=fy.next())b0=Vz.value,H_=g.V(b0),kV=H_.next().value,U7=H_.next().value,U1=kV,qM=U7,D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U1,"musicTrack",k8,E4,G9(W,qM)));hG=g.V(jn);for(tm=hG.next();!tm.done;tm=hG.next())Zf=tm.value,D7.push(Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Zf,"musicTrack",0,E4));return KP.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,D7))}})},OTR=function(Q,W){var x,D;
return g.U(function(K){switch(K.B){case 1:return x=wA(W),g.P5(K,2),D=g.jd(W.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.A(K,a$(Q.B,W,Q.D),5):g.A(K,hM(D,"musicPlaylist",Q.B,W,Q.D),6);case 6:return g.A(K,hbA(Q.B,W.entityKey),5);case 5:g.Cs(K,3);break;case 2:return g.Jv(K),K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},LS7=function(Q,W,x,D){var K,l,M;
return g.U(function(w){switch(w.B){case 1:return g.A(w,AHJ([W]),2);case 2:return K=w.U,g.A(w,ERJ(Q,K[0],x,D),3);case 3:return l=w.U,M=o$(l.thumbnailDetails),g.A(w,Pz(M),4);case 4:return w.return(K[0].videos)}})},ERJ=function(Q,W,x,D){var K,l,M,w,S,b,z,k,X;
return g.U(function(u){return u.B==1?(K=W.playlistId,l=aG7(W),M=l.mK,w=l.UE,S=x?(Number(x)*1E3).toString():Date.now().toString(),b=W.lastModifiedTimestamp?(Number(W.lastModifiedTimestamp)*1E3).toString():"0",z={id:g.Mb(K,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:w,lastModifiedTimestampMillis:b,addedTimestampMillis:S,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},k={id:g.Mb(K,"musicPlaylist"),title:W.title,playlistId:K,thumbnailDetails:W.thumbnail,visibility:FSF(W),trackCount:W.totalVideoCount,
tracks:M,downloadMetadata:z.id},D&&(((X=k)==null?0:X.entityMetadata)?k.entityMetadata.nextAutoRefreshIntervalSeconds=String(D):k&&(k.entityMetadata={nextAutoRefreshIntervalSeconds:String(D)})),g.A(u,Tc(Q.B,{mode:"readwrite",dG:!0},function(Y){var v=fF(Y,k,"musicPlaylist");Y=fF(Y,z,"musicPlaylistDownloadMetadataEntity");return g.CX.all([v,Y])}),2)):u.return(k)})},FSF=function(Q){switch(Q.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},t$R=function(Q,W){this.B=Q;
this.D=W},D15=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y;
return g.U(function(v){switch(v.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,l=g.e(W.actionMetadata,Q2e),g.P5(v,2),g.A(v,WgF(Q,K,void 0,(M=l)==null?void 0:M.track,(w=l)==null?void 0:w.albumRelease),4);case 4:if((S=l)==null?0:S.playlistId){v.kf(5);break}return g.A(v,pFe(Q.B,W.entityKey),5);case 5:g.Cs(v,3);break;case 2:return b=g.Jv(v),z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.o8&&b.type==="QUOTA_EXCEEDED"&&
(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,z,k));case 3:u=Number(((X=W.actionMetadata)==null?void 0:X.priority)||0)+1;var J=(J=g.e(W.actionMetadata,Q2e))?{playbackDataActionMetadata:{maximumDownloadQuality:J.maximumDownloadQuality}}:void 0;Y=Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K,"playbackData",u,x1p,J);return v.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x,[Y]))}})},KgC=function(Q,W){var x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J;
return g.U(function(h){switch(h.B){case 1:return x=wA(W),D=g.jd(W.entityKey),K=D.entityId,g.A(h,E8(Q.B,W.entityKey,"musicTrack"),2);case 2:l=h.U;if(!l){M=void 0;h.kf(3);break}return g.A(h,E8(Q.B,l.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:M=h.U;case 3:w=M;if(!l||!w)return h.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x));b=g.e(W.actionMetadata,Q2e);g.P5(h,5);return g.A(h,WgF(Q,K,w.addedTimestampMillis,(z=b)==null?void 0:z.track,(k=b)==null?void 0:k.albumRelease),
7);case 7:u=Number(((X=W.actionMetadata)==null?void 0:X.priority)||0)+1;S=Hz("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",K,"playbackData",u,x1p);g.Cs(h,6);break;case 5:Y=g.Jv(h);if(!(Y instanceof Error&&Y.message==="No data")){if(Y instanceof Error&&Y.message==="Empty response body")Dq(Y.message);else return v="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.o8&&Y.type==="QUOTA_EXCEEDED"&&(v="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,v,J));h.kf(6);break}return g.A(h,pe(K,Q.B,W,Q.D),6);case 6:return h.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",x,S?[S]:void 0))}})},l9k=function(Q,W){var x,D;
return g.U(function(K){switch(K.B){case 1:return x=wA(W),g.P5(K,2),D=g.jd(W.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.A(K,a$(Q.B,W,Q.D),5):g.A(K,pe(D,Q.B,W,Q.D),6);case 6:return g.A(K,hbA(Q.B,W.entityKey),5);case 5:g.Cs(K,3);break;case 2:return g.Jv(K),K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",x,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new U4("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
x))}})},WgF=function(Q,W,x,D,K){var l,M,w,S,b,z;
return g.U(function(k){switch(k.B){case 1:if(l=D){k.kf(2);break}return g.A(k,iZC([W]),3);case 3:M=k.U,w=M[0],l=JH1(w);case 2:return g.A(k,j2u(Q,l,W,K,x),4);case 4:S=k.U;b=S.musicTrackEntity;z=S.gB;var X=o$(b.thumbnailDetails),u=[];z&&(u=o$(z.thumbnailDetails));return g.A(k,Pz(X.concat(u)),0)}})},j2u=function(Q,W,x,D,K){var l;
return g.U(function(M){return M.B==1?(K||(K=Date.now().toString()),l={id:g.Mb(x,"musicTrackDownloadMetadataEntity"),playbackData:g.Mb(x,"playbackData"),addedTimestampMillis:K,videoDownloadContextEntity:g.Mb(x,"videoDownloadContextEntity")},D&&(W.albumRelease=D.id),g.A(M,Tc(Q.B,{mode:"readwrite",dG:!0},function(w){var S=[],b=fF(w,l,"musicTrackDownloadMetadataEntity");S.push(b);b=fF(w,W,"musicTrack");S.push(b);D&&(w=fF(w,D,"musicAlbumRelease"),S.push(w));return g.CX.all(S)}),2)):M.B!=3?g.A(M,z9(x,"musicTrackDownloadMetadataEntity",
Q.B,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):M.return({musicTrackEntity:W,
gB:D})})},Fg=function(){Zq.apply(this,arguments);
this.T="musicTrack"},MSY=function(Q,W,x){W=W===void 0?43200:W;
x=x===void 0?!0:x;var D=D===void 0?!1:D;var K,l;return g.U(function(M){switch(M.B){case 1:if(!Q.X.yv())return M.return([]);K=[];g.P5(M,2);return g.A(M,IGs(W,x,D),4);case 4:K=M.U;g.Cs(M,3);break;case 2:g.Jv(M);case 3:return l=zQJ(Q,K,x,"musicPlaylist"),M.return(l)}})},R6C=function(){g.V1.apply(this,arguments);
var Q=this;this.events=new g.I0(this);this.bj=this.player.C();this.by={WD5:function(){return Q.B},
dA:function(){return Q.dA()},
Ci:function(W){return Q.Ci(W)}}},wvH=function(Q){var W;
Q=g.e((W=Q.getWatchNextResponse())==null?void 0:W.currentVideoEndpoint,g.tQ);if(Q==null?0:Q.playlistId)var x=Q.playlistId;return x},Sb7=function(Q,W){var x,D,K,l;
return g.U(function(M){if(M.B==1){x=W.clientPlaybackNonce;D={cpn:x,offlineSourceVisualElement:g.vp(W.fS||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};W.U&&(D.videoFmt=Number(W.U.itag));W.N&&(D.audioFmt=Number(W.N.itag));if((K=wvH(W))&&W.videoId){var w=W.videoId;w=K!=="PPSV"?Promise.resolve(!1):Q.B.Dg(w);M=g.A(M,w,3)}else M=M.kf(2);return M}M.B!=2&&(l=M.U)&&(D.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Q.U=x;g.wV("offlinePlaybackStarted",D);g.VF(M)})};
g.ho.prototype.rL=g.D5(45,function(Q){return this.app.rL(Q)});
g.uk.prototype.rL=g.D5(44,function(Q){return g.yMa(this,9,Q)});
g.n($x,Bw);g.R1.Object.defineProperties($x.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.B.entityMetadata},
set:function(Q){this.B.entityMetadata=Q}}});
g.n(jHe,$x);jHe.prototype.U=function(){return[]};
g.n(Mrk,$x);Mrk.prototype.U=function(){return[]};
g.n(R_Y,$x);R_Y.prototype.U=function(){return[]};
g.n(w0R,$x);w0R.prototype.U=function(){return[]};
g.n(S1Y,$x);S1Y.prototype.U=function(){var Q=[];this.B.alternateChannel&&Q.push(this.B.alternateChannel);this.B.alternateChannelList&&Q.push.apply(Q,g.C(this.B.alternateChannelList));this.B.oneofChannelEntity&&Q.push(this.B.oneofChannelEntity);return[].concat(g.C(new Set(Q)))};
g.n(b45,$x);b45.prototype.U=function(){var Q=[];this.B.entryCollection&&Q.push(this.B.entryCollection);return[].concat(g.C(new Set(Q)))};
g.n(sHH,Bw);sHH.prototype.U=function(){var Q=[];this.B.video&&Q.push(this.B.video);return[].concat(g.C(new Set(Q)))};
g.n(z_5,$x);z_5.prototype.U=function(){var Q=[];this.B.parentPlaylist&&Q.push(this.B.parentPlaylist);if(this.B.entries)for(var W=g.V(this.B.entries),x=W.next();!x.done;x=W.next())Q.push.apply(Q,g.C((new sHH(x.value)).U()));return[].concat(g.C(new Set(Q)))};
g.n(kYA,$x);kYA.prototype.U=function(){var Q=[];this.B.descriptionEntity&&Q.push(this.B.descriptionEntity);this.B.creators&&Q.push.apply(Q,g.C(this.B.creators));this.B.theBiggestFan&&Q.push(this.B.theBiggestFan);return[].concat(g.C(new Set(Q)))};
g.n(X05,$x);X05.prototype.U=function(){return[]};
g.n(ols,$x);ols.prototype.U=function(){return[]};
g.n(uA5,$x);uA5.prototype.U=function(){return[]};
g.n(Y1p,$x);Y1p.prototype.U=function(){return[]};
g.n(nl7,$x);nl7.prototype.U=function(){return[]};
g.n(VrJ,$x);VrJ.prototype.U=function(){return[]};
g.n(PTC,$x);PTC.prototype.U=function(){return[]};
g.n(vl1,$x);vl1.prototype.U=function(){return[]};
g.n(CTs,$x);CTs.prototype.U=function(){return[]};
g.n(JFu,$x);JFu.prototype.U=function(){var Q=[];this.B.downloadsList&&Q.push(this.B.downloadsList);this.B.smartDownloadsList&&Q.push(this.B.smartDownloadsList);this.B.recommendedDownloadsList&&Q.push(this.B.recommendedDownloadsList);this.B.refresh&&Q.push(this.B.refresh);return[].concat(g.C(new Set(Q)))};
g.n(p0R,Bw);p0R.prototype.U=function(){var Q=[];this.B.video&&Q.push(this.B.video);this.B.playlist&&Q.push(this.B.playlist);this.B.videoItem&&Q.push(this.B.videoItem);this.B.playlistItem&&Q.push(this.B.playlistItem);return[].concat(g.C(new Set(Q)))};
g.n(h_C,$x);h_C.prototype.U=function(){var Q=[];this.B.refresh&&Q.push(this.B.refresh);if(this.B.downloads)for(var W=g.V(this.B.downloads),x=W.next();!x.done;x=W.next())Q.push.apply(Q,g.C((new p0R(x.value)).U()));return[].concat(g.C(new Set(Q)))};
g.n(aFR,$x);aFR.prototype.U=function(){var Q=[];this.B.localImageEntities&&Q.push.apply(Q,g.C(this.B.localImageEntities));return[].concat(g.C(new Set(Q)))};
g.n(GY7,$x);GY7.prototype.U=function(){var Q=[];this.B.playbackData&&Q.push(this.B.playbackData);this.B.localImageEntities&&Q.push.apply(Q,g.C(this.B.localImageEntities));this.B.videoDownloadContextEntity&&Q.push(this.B.videoDownloadContextEntity);return[].concat(g.C(new Set(Q)))};
g.n(dM5,$x);dM5.prototype.U=function(){return[]};
g.n(i4p,$x);i4p.prototype.U=function(){var Q=[];this.B.fakeChildren&&Q.push.apply(Q,g.C(this.B.fakeChildren));return[].concat(g.C(new Set(Q)))};
g.n(AFu,$x);AFu.prototype.U=function(){var Q=[];this.B.video&&Q.push(this.B.video);this.B.playbackData&&Q.push(this.B.playbackData);this.B.offlineVideoPolicy&&Q.push(this.B.offlineVideoPolicy);return[].concat(g.C(new Set(Q)))};
g.n(H45,$x);H45.prototype.U=function(){return[]};
g.n(UMs,$x);UMs.prototype.U=function(){var Q=[];this.B.channelOwner&&Q.push(this.B.channelOwner);this.B.videos&&Q.push.apply(Q,g.C(this.B.videos));this.B.collaboratorChannels&&Q.push.apply(Q,g.C(this.B.collaboratorChannels));this.B.downloadState&&Q.push(this.B.downloadState);this.B.refresh&&Q.push(this.B.refresh);return[].concat(g.C(new Set(Q)))};
g.n(q1p,$x);q1p.prototype.U=function(){var Q=[];this.B.video&&Q.push(this.B.video);this.B.channelContributor&&Q.push(this.B.channelContributor);return[].concat(g.C(new Set(Q)))};
g.n(BB5,Bw);BB5.prototype.U=function(){var Q=[];this.B.localImageEntities&&Q.push.apply(Q,g.C(this.B.localImageEntities));this.B.videoDownloadContextEntity&&Q.push(this.B.videoDownloadContextEntity);return[].concat(g.C(new Set(Q)))};
g.n($MR,Bw);$MR.prototype.U=function(){var Q=[];this.B.recommendedVideoMetadata&&Q.push.apply(Q,g.C((new BB5(this.B.recommendedVideoMetadata)).U()));return[].concat(g.C(new Set(Q)))};
g.n(IFs,Bw);IFs.prototype.U=function(){var Q=[];this.B.playbackPosition&&Q.push(this.B.playbackPosition);return[].concat(g.C(new Set(Q)))};
g.n(mMe,$x);mMe.prototype.U=function(){var Q=[];this.B.owner&&Q.push(this.B.owner);this.B.downloadState&&Q.push(this.B.downloadState);this.B.userState&&Q.push.apply(Q,g.C((new IFs(this.B.userState)).U()));this.B.additionalMetadata&&Q.push.apply(Q,g.C((new $MR(this.B.additionalMetadata)).U()));return[].concat(g.C(new Set(Q)))};
g.n(NBH,$x);NBH.prototype.U=function(){var Q=[];this.B.userChannelDetails&&Q.push(this.B.userChannelDetails);return[].concat(g.C(new Set(Q)))};
g.n(cFu,$x);cFu.prototype.U=function(){var Q=[];this.B.channelOwner&&Q.push(this.B.channelOwner);this.B.playbackPosition&&Q.push(this.B.playbackPosition);this.B.localImageEntities&&Q.push.apply(Q,g.C(this.B.localImageEntities));this.B.downloadStatus&&Q.push(this.B.downloadStatus);return[].concat(g.C(new Set(Q)))};
g.n(glH,$x);glH.prototype.U=function(){return[]};
g.n(yFu,$x);yFu.prototype.U=function(){return[]};
g.n(e_s,$x);e_s.prototype.U=function(){return[]};
g.n(fFk,$x);fFk.prototype.U=function(){return[]};
g.n(Z4C,$x);Z4C.prototype.U=function(){return[]};
g.n(L6Y,$x);L6Y.prototype.U=function(){return[]};
g.n(rF5,$x);rF5.prototype.U=function(){return[]};
g.n(TBC,$x);TBC.prototype.U=function(){return[]};
g.n(O4q,$x);O4q.prototype.U=function(){return[]};
g.n(Ele,$x);Ele.prototype.U=function(){return[]};
g.n(F6H,$x);F6H.prototype.U=function(){return[]};
g.n(trq,$x);trq.prototype.U=function(){var Q=[];this.B.trackDownloadMetadatas&&Q.push.apply(Q,g.C(this.B.trackDownloadMetadatas));return[].concat(g.C(new Set(Q)))};
g.n(QXJ,$x);
QXJ.prototype.U=function(){var Q=[];this.B.downloadedTracks&&Q.push.apply(Q,g.C(this.B.downloadedTracks));this.B.smartDownloadedTracks&&Q.push.apply(Q,g.C(this.B.smartDownloadedTracks));this.B.downloadedEpisodes&&Q.push.apply(Q,g.C(this.B.downloadedEpisodes));this.B.downloadedAlbumReleases&&Q.push.apply(Q,g.C(this.B.downloadedAlbumReleases));this.B.smartDownloadedAlbumReleases&&Q.push.apply(Q,g.C(this.B.smartDownloadedAlbumReleases));this.B.downloadedPlaylists&&Q.push.apply(Q,g.C(this.B.downloadedPlaylists));this.B.smartDownloadedPlaylists&&
Q.push.apply(Q,g.C(this.B.smartDownloadedPlaylists));this.B.metadataOnlyTracks&&Q.push.apply(Q,g.C(this.B.metadataOnlyTracks));return[].concat(g.C(new Set(Q)))};
g.n(Wns,$x);Wns.prototype.U=function(){var Q=[];this.B.trackDownloadMetadatas&&Q.push.apply(Q,g.C(this.B.trackDownloadMetadatas));return[].concat(g.C(new Set(Q)))};
g.n(x2s,$x);x2s.prototype.U=function(){var Q=[];this.B.playbackData&&Q.push(this.B.playbackData);this.B.localImageEntities&&Q.push.apply(Q,g.C(this.B.localImageEntities));this.B.videoDownloadContextEntity&&Q.push(this.B.videoDownloadContextEntity);return[].concat(g.C(new Set(Q)))};
g.n(D2u,$x);D2u.prototype.U=function(){var Q=[];this.B.musicLibraryStatusEntity&&Q.push(this.B.musicLibraryStatusEntity);this.B.primaryArtists&&Q.push.apply(Q,g.C(this.B.primaryArtists));this.B.details&&Q.push(this.B.details);this.B.userDetails&&Q.push(this.B.userDetails);this.B.tracks&&Q.push.apply(Q,g.C(this.B.tracks));this.B.share&&Q.push(this.B.share);this.B.downloadMetadata&&Q.push(this.B.downloadMetadata);this.B.refresh&&Q.push(this.B.refresh);return[].concat(g.C(new Set(Q)))};
g.n(Kn5,$x);Kn5.prototype.U=function(){var Q=[];this.B.albumRelease&&Q.push(this.B.albumRelease);this.B.tracks&&Q.push.apply(Q,g.C(this.B.tracks));return[].concat(g.C(new Set(Q)))};
g.n(lmp,$x);lmp.prototype.U=function(){var Q=[];this.B.albumRelease&&Q.push(this.B.albumRelease);return[].concat(g.C(new Set(Q)))};
g.n(jXq,$x);jXq.prototype.U=function(){var Q=[];this.B.details&&Q.push(this.B.details);this.B.userDetails&&Q.push(this.B.userDetails);return[].concat(g.C(new Set(Q)))};
g.n(Muq,$x);Muq.prototype.U=function(){var Q=[];this.B.parentArtist&&Q.push(this.B.parentArtist);return[].concat(g.C(new Set(Q)))};
g.n(RJq,$x);RJq.prototype.U=function(){var Q=[];this.B.parentArtist&&Q.push(this.B.parentArtist);return[].concat(g.C(new Set(Q)))};
g.n(wCe,$x);wCe.prototype.U=function(){return[]};
g.n(SWH,$x);SWH.prototype.U=function(){return[]};
g.n(bmH,Bw);bmH.prototype.U=function(){var Q=[];this.B.creatorEntity&&Q.push(this.B.creatorEntity);return[].concat(g.C(new Set(Q)))};
g.n(sXs,$x);
sXs.prototype.U=function(){var Q=[];this.B.tracks&&Q.push.apply(Q,g.C(this.B.tracks));this.B.refresh&&Q.push(this.B.refresh);this.B.musicLibraryStatusEntity&&Q.push(this.B.musicLibraryStatusEntity);this.B.details&&Q.push(this.B.details);this.B.downloadMetadata&&Q.push(this.B.downloadMetadata);this.B.sideloadMetadata&&Q.push(this.B.sideloadMetadata);this.B.userDetails&&Q.push(this.B.userDetails);this.B.entryCollection&&Q.push(this.B.entryCollection);this.B.share&&Q.push(this.B.share);this.B.podcastShowAdditionalMetadata&&Q.push.apply(Q,
g.C((new bmH(this.B.podcastShowAdditionalMetadata)).U()));return[].concat(g.C(new Set(Q)))};
g.n(zJR,$x);zJR.prototype.U=function(){return[]};
g.n(kks,$x);
kks.prototype.U=function(){var Q=[];this.B.musicLibraryStatusEntity&&Q.push(this.B.musicLibraryStatusEntity);this.B.artists&&Q.push.apply(Q,g.C(this.B.artists));this.B.audioModeVersion&&Q.push(this.B.audioModeVersion);this.B.videoModeVersion&&Q.push(this.B.videoModeVersion);this.B.userDetails&&Q.push(this.B.userDetails);this.B.details&&Q.push(this.B.details);this.B.albumRelease&&Q.push(this.B.albumRelease);this.B.share&&Q.push(this.B.share);this.B.libraryEdit&&Q.push(this.B.libraryEdit);this.B.downloadMetadata&&
Q.push(this.B.downloadMetadata);this.B.playbackPosition&&Q.push(this.B.playbackPosition);this.B.lyrics&&Q.push(this.B.lyrics);return[].concat(g.C(new Set(Q)))};
g.n(XCJ,$x);XCJ.prototype.U=function(){var Q=[];this.B.parentTrack&&Q.push(this.B.parentTrack);return[].concat(g.C(new Set(Q)))};
g.n(oGs,$x);oGs.prototype.U=function(){var Q=[];this.B.parentTrack&&Q.push(this.B.parentTrack);return[].concat(g.C(new Set(Q)))};
g.n(unp,$x);unp.prototype.U=function(){return[]};
g.n(YWq,$x);YWq.prototype.U=function(){return[]};
g.n(nGJ,$x);nGJ.prototype.U=function(){return[]};
g.n(VuR,$x);VuR.prototype.U=function(){return[]};
g.n(PRR,$x);PRR.prototype.U=function(){var Q=[];this.B.transfer&&Q.push(this.B.transfer);this.B.adsPlaybackData&&Q.push.apply(Q,g.C(this.B.adsPlaybackData));this.B.drmLicense&&Q.push(this.B.drmLicense);this.B.offlineVideoPolicy&&Q.push(this.B.offlineVideoPolicy);this.B.videoDownloadContextEntity&&Q.push(this.B.videoDownloadContextEntity);return[].concat(g.C(new Set(Q)))};
g.n(vGp,$x);vGp.prototype.U=function(){return[]};
g.n(CRe,$x);CRe.prototype.U=function(){var Q=[];this.B.offlineVideoStreams&&Q.push.apply(Q,g.C(this.B.offlineVideoStreams));this.B.captionTrack&&Q.push.apply(Q,g.C(this.B.captionTrack));return[].concat(g.C(new Set(Q)))};
g.n(J8A,$x);J8A.prototype.U=function(){return[]};
g.n(pCR,$x);pCR.prototype.U=function(){return[]};
g.n(hJ5,$x);hJ5.prototype.U=function(){return[]};
g.n(am1,$x);am1.prototype.U=function(){return[]};
g.n(Gkk,$x);Gkk.prototype.U=function(){return[]};
g.n(d2H,$x);d2H.prototype.U=function(){return[]};
g.n(im1,$x);im1.prototype.U=function(){return[]};
g.n(A8p,$x);A8p.prototype.U=function(){return[]};
g.n(HmJ,$x);HmJ.prototype.U=function(){return[]};
g.n(U2k,$x);U2k.prototype.U=function(){return[]};
g.n(qWp,$x);qWp.prototype.U=function(){return[]};
g.n(BuA,$x);BuA.prototype.U=function(){return[]};
g.n($2e,$x);$2e.prototype.U=function(){return[]};
g.n(Imk,$x);Imk.prototype.U=function(){return[]};
g.n(m2k,$x);m2k.prototype.U=function(){return[]};
g.n(Nuq,$x);Nuq.prototype.U=function(){return[]};
g.n(c8J,$x);c8J.prototype.U=function(){return[]};
g.n(gG1,$x);gG1.prototype.U=function(){return[]};
var m7q=["browse","music/browse","unplugged/browse"],eb1=["offline/playlist_sync_check"],d7C=["offline"],NJe=["offline/offline_video_playback_position_sync"],gkY=["offline/get_playback_data_entity"],In;m8.getInstance=function(){return g.U(function(Q){return Q.return(new Promise(function(W){g.Fi().then(function(x){x?(m8.instance||(m8.instance=new m8(x)),W(m8.instance)):W(void 0)})}))})};
m8.prototype.get=function(Q){var W=this,x,D,K;return g.U(function(l){if(l.B==1)return g.A(l,ZmH(W.token),2);if(l.B!=3)return x=l.U,g.A(l,x.get("prefs",Q),3);D=l.U;if(!D)return l.return();K=(0,g.a8)();return D.expirationTimestampMs<=K?l.return():l.return(D.value)})};
m8.prototype.set=function(Q,W,x){x=x===void 0?31536E3:x;var D=this,K,l,M;return g.U(function(w){if(w.B==1)return K=(0,g.a8)(),l={key:Q,value:W,expirationTimestampMs:K+x*1E3},g.A(w,ZmH(D.token),2);M=w.U;return g.A(w,g.UU(M,"prefs",l),0)})};
m8.prototype.remove=function(Q){var W=this,x;return g.U(function(D){if(D.B==1)return g.A(D,ZmH(W.token),2);x=D.U;return g.A(D,x.delete("prefs",Q),0)})};
g.n(NX,g.Lw);g.n(cw,EGq);cw.prototype.D=function(Q,W){W=tu7(W);Q=(new TextEncoder).encode(JSON.stringify(Q));return this.B.encrypt(Q,W)};
cw.prototype.U=function(Q,W){if(!(Q instanceof Uint8Array))throw Lnk(1);var x=new TextDecoder;W=tu7(W);Q=this.B.decrypt(Q,W);return JSON.parse(x.decode(Q))};
var QB1={accountLinkStatusEntity:uA5,booleanEntity:R_Y,buttonEntity:qWp,captionTrack:unp,channelHandle:jHe,commerceAcquisitionClientPayloadEntity:$2e,commerceCartListEntity:Imk,contextNoteFeedEntityPayload:Mrk,continuationTokenEntity:H45,downloadQualityPickerEntity:PTC,downloadsPageRefreshTokenEntity:CTs,downloadsPageViewConfigurationEntity:glH,downloadStatusEntity:vl1,dismissState:Gkk,sfvAudioItemCurrentlyPlayingEntity:pCR,emojiFountainDataEntity:HmJ,emojiCustomizationSetEntity:A8p,fakeChannel:S1Y,
fakePlaylist:b45,fakePlaylistEntryCollection:z_5,fakeVideo:kYA,fakeVideoDescription:X05,featuredProductsEntity:O4q,flowStateEntity:ols,iconBadgeEntity:m2k,interstitialInteractionStateEntity:nl7,likeButtonAnimationEntity:yFu,liveChatPollStateEntity:VrJ,liveReactionsDataEntity:U2k,logoEntity:Y1p,macroMarkerEntity:e_s,mainDownloadsLibraryEntity:JFu,mainDownloadsListEntity:h_C,mainPlaylistDownloadStateEntity:aFR,mainPlaylistEntity:UMs,mainPlaylistVideoEntity:q1p,mainVideoDownloadStateEntity:GY7,mainVideoEntity:mMe,
markersEngagementPanelSyncEntity:fFk,markersVisibilityOverrideEntity:Z4C,musicAlbumReleaseDetail:Kn5,musicAlbumReleaseDownloadMetadataEntity:trq,musicAlbumRelease:D2u,musicAlbumReleaseUserDetail:lmp,musicArtistDetail:Muq,musicArtist:jXq,musicArtistUserDetail:RJq,musicDownloadsLibraryEntity:QXJ,musicLibraryEdit:wCe,musicLibraryStatusEntity:SWH,musicPlaylist:sXs,musicPlaylistDownloadMetadataEntity:Wns,musicShare:zJR,musicTrackDetail:XCJ,musicTrackDownloadMetadataEntity:x2s,musicTrack:kks,musicTrackUserDetail:oGs,
offlineOrchestrationActionWrapperEntity:YWq,offlineVideoPolicy:nGJ,offlineVideoStreams:VuR,offlineabilityEntity:dM5,orchestrationWebSamplingEntity:i4p,pageHeaderEntity:d2H,pdpStateEntity:Nuq,pinnedProductEntity:Ele,playbackData:PRR,playerStateEntity:L6Y,quantityIncrementerEntity:c8J,refresh:vGp,saveToPlaylistListEntity:hJ5,settingEntity:am1,stringEntity:w0R,suggestedFeedbackChipStateEntity:rF5,transfer:CRe,trendingOfferEntity:F6H,videoDownloadContextEntity:J8A,videoOverviewAsyncDataEntity:gG1,videoPlaybackPositionEntity:BuA,
votingEntity:im1,ytMainChannelEntity:NBH,youchatPendingResponseEntity:TBC,ytMainDownloadedVideoEntity:AFu,ytMainVideoEntity:cFu};g.n(LF,EGq);LF.prototype.D=function(Q){return Q};
LF.prototype.U=function(Q){if(Q instanceof Uint8Array)throw Lnk(0);return Q};
g.n(rU,g.N);rU.prototype.observe=function(Q){var W=this;this.observers.push(Q);return function(){var x=W.observers.indexOf(Q);x>=0&&W.observers.splice(x,1)}};
rU.prototype.U=function(Q){kJk(this,Q.data)};
rU.prototype.U3=function(){this.channel.close()};
var ngH,XF5=new g.a2("elementsCommand");var Ce=new g.a2("entityBatchUpdate");var D7k=new g.a2("downloadStatusEntity");var nR5=new g.a2("mainPlaylistEntityActionMetadata");var T9=new g.a2("mainVideoEntityActionMetadata");var GNH=new g.a2("musicPlaylistEntityActionMetadata");var Q2e=new g.a2("musicTrackEntityActionMetadata");var qIs=new g.a2("localImageEntityActionMetadata");var qV=new g.a2("playbackDataActionMetadata");var oB1=new g.a2("transferEntityActionMetadata");var Wiu=new g.a2("videoPlaybackPositionEntityActionMetadata");var qBe;new g.XT;new g.XT;NMp.prototype.request=function(Q,W,x){W=W===void 0?{}:W;return this.locks.request(Q,W,function(D){return x(D)})};var xr=g.Nz.caches,Wz,fiC;QG.prototype.open=function(Q){return xr.open(yPA(Q))};
QG.prototype.has=function(Q){return xr.has(yPA(Q))};
QG.prototype.delete=function(Q){return xr.delete(yPA(Q))};
QG.prototype.match=function(Q,W){var x=this,D,K,l,M,w,S;return g.U(function(b){switch(b.B){case 1:return g.A(b,x.keys(),2);case 2:D=b.U,K=g.V(D),l=K.next();case 3:if(l.done){b.kf(5);break}M=l.value;return g.A(b,x.open(M),6);case 6:return w=b.U,g.A(b,w.match(Q,W),7);case 7:if(S=b.U)return b.return(S);l=K.next();b.kf(3);break;case 5:return b.return()}})};
g.n(gg7,QG);gg7.prototype.keys=function(){var Q,W,x,D,K,l,M,w,S;return g.U(function(b){if(b.B==1)return Q=[],W=g.r3("CacheStorage keys"),g.A(b,xr.keys(),2);x=b.U;D=g.V(x);for(K=D.next();!K.done;K=D.next()){l=K.value;var z=l.indexOf(":");M=z===-1?{U5:l}:{U5:l.substring(0,z),datasyncId:l.substring(z+1)};w=M.U5;S=M.datasyncId;S===W&&Q.push(w)}return b.return(Q)})};g.n(Ke,g.N);Ke.prototype.D=function(Q){this.api.Wt("onOfflineOperationFailure",Q.data)};
Ke.prototype.N=function(Q){this.api.publish("offlinetransferpause",Q.data)};
Ke.prototype.U3=function(){var Q;(Q=this.B)==null||Q.close();var W;(W=this.U)==null||W.close()};rPH.prototype.PZ=function(){this.B&&jR(this)};
rPH.prototype.i4=function(){this.U&&this.U.resolve();this.D=this.B=!1;this.T()};var H81=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var svF="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var CxY="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.n(ZZ1,AM);ZZ1.prototype.U=function(Q){return SR(Q)?TJR(this,Q):b_(Q)?FbR(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.n(tOu,AM);tOu.prototype.U=function(Q){return b_(Q)?Qbs(this,Q):x75(Q)?xnA(this,Q):s4(Q)?DnY(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.R=KiA.prototype;g.R.LJ9=function(Q){var W=this,x,D,K,l;return g.U(function(M){if(!g.r(Q.state,128))return M.kf(0);x=Q.state.HI;var w=(D=x)==null?void 0:D.errorCode,S=(K=x)==null?void 0:K.aF;l=w==="net.connect"&&S===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(w==null?0:w.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.A(M,W.Hl(W.player.getVideoData().videoId,l),0)})};
g.R.Hl=function(Q,W){var x=this;return g.U(function(D){if(D.B==1){if(x.U)return D.return();x.U=!0;return W==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(I$(x,Q,!1,!0),D.kf(0)):g.A(D,$r(x,Q),3)}g.AQ(Q,4);return g.A(D,x.B.Hl(W),0)})};
g.R.Sb=function(Q){Q.status===2?(Q.status!==this.D&&(QrH(this.B),g.AQ(Q.videoId,2)),Q.Jw&&lER(this.B,Q.videoId,Q.Jw)):Q.status===4?($r(this,Q.videoId),this.Hl(Q.videoId,Q.Gb?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Q.status===1&&KS7(this.B);this.D=Q.status;this.api.Wt("localmediachange",{videoId:Q.videoId,status:Q.status})};
g.R.Ai=function(){var Q=this,W;return g.U(function(x){if(x.B==1){if(Q.U)return x.return();Q.U=!0;W=Q.player.getVideoData().videoId;return g.A(x,$r(Q,W),2)}return g.A(x,Q.B.Ai(),0)})};
g.R.xB=function(Q){switch(Q){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.R.j=function(Q){return this.api.C().j(Q)};g.n(b8R,AM);b8R.prototype.U=function(Q){return SR(Q)?zpe(this,Q):b_(Q)?kdp(this,Q):x75(Q)?Xtp(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};Pp7.prototype.B=function(Q,W){var x=Q.action.actionMetadata.priority-W.action.actionMetadata.priority;x===0&&(Q.B<W.B?x=-1:Q.B>W.B&&(x=1));return x};g.n(mz,g.N);mz.prototype.U3=function(){this.T&&this.T();g.N.prototype.U3.call(this)};
mz.prototype.createAction=function(Q,W){var x=g.jd(Q.entityKey).entityType,D=g.Cu(16);return new u_(x,D,Q,W.actionId,W.rootActionId)};
mz.prototype.pS=function(Q){var W=this,x,D,K,l,M,w,S,b,z;return g.U(function(k){if(k.B==1){if(W.d7())return k.return();D=(x=Q.offlineOrchestrationActionWrapperEntity)!=null?x:new Set;K=[];l=g.V(D);for(M=l.next();!M.done;M=l.next())w=M.value,S=g.jd(w),b=S.entityId,J2s(W.B,b)||K.push(w);return g.A(k,Bxp(W,K),2)}z=k.U;return g.A(k,q3u(W,z),0)})};
mz.prototype.retry=function(){var Q=this;return g.U(function(W){return g.A(W,$nR(Q),0)})};mnH.prototype.vK=function(Q,W){W=W===void 0?!0:W;var x=this,D,K,l,M,w,S,b,z;return g.U(function(k){switch(k.B){case 1:if(!x.B)return k.return();D=[];K=g.Mt(x.B.U,W);l=[];for(M={Eq:0};M.Eq<K.length;M={Eq:M.Eq},M.Eq++)w=K[M.Eq],S=x.B.ON(w,"json3"),b=g.iY(S,{withCredentials:!0,format:"RAW"},3,500).then(function(X){return function(u){u={metadata:g.of(K[X.Eq]),trackData:u.xhr.responseText};l.push(u)}}(M)).RH(function(X){Dq("Caption fetch error",X)}),D.push(b);
return g.A(k,lFA(D),2);case 2:return g.P5(k,3),g.A(k,aiY(Q,l),5);case 5:g.Cs(k,0);break;case 3:z=g.Jv(k),Dq("Caption DB transaction error",z),g.VF(k)}})};g.n(NV,g.N);NV.prototype.U3=function(){this.U&&this.U();g.N.prototype.U3.call(this)};
NV.prototype.D=function(Q){var W=this,x,D,K,l,M,w,S,b;return g.U(function(z){D=(x=Q.transfer)!=null?x:new Set;K=[];l=g.V(D);for(M=l.next();!M.done;M=l.next())w=M.value,S=g.jd(w),b=S.entityId,K.push(b);return K.length===0?z.return():g.A(z,gB1(W,K),0)})};g.n(Lip,g.N);g.R=Lip.prototype;g.R.U3=function(){this.F3&&this.F3();this.KS.dispose();this.N.dispose();this.X3&&g.mX(this.X.Kv,this.X3);this.LS&&g.mX(this.X.Kv,this.LS);g.N.prototype.U3.call(this)};
g.R.stj=function(Q){var W=this,x,D,K;return g.U(function(l){switch(l.B){case 1:x=g.Mb(Q,"transfer");if(W.B&&x===W.B.key){I$(W.G,W.L,!0);W.N.stop();l.kf(0);break}return g.A(l,Tc(W.U,{mode:"readwrite",dG:!0},function(M){return gU(M,x,"transfer").then(function(w){if(w&&w.transferState!=="TRANSFER_STATE_COMPLETE"&&w.transferState!=="TRANSFER_STATE_FAILED")return w.transferState="TRANSFER_STATE_PAUSED_BY_USER",fF(M,w,"transfer").then(function(){return w})})}),3);
case 3:D=l.U;if(!D){l.kf(0);break}if(!Q||!W.D){l.kf(5);break}return g.A(l,z9(Q,W.D,W.U,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.A(l,yG(W,Q),7);case 7:K=l.U,Qve({videoId:Q,t9:D,offlineModeType:K}),g.VF(l)}})};
g.R.exj=function(){var Q=this;if(this.B&&this.L){I$(this.G,this.L,!1);var W=this.B,x=(W==null?0:W.key)?g.jd(W.key).entityId:"";x&&this.D&&(new Promise(function(D,K){z9(x,Q.D,Q.U,"DOWNLOAD_STATE_PAUSED").catch(function(l){K(l)})})).catch(function(D){Dq("Download state setting error",D)})}this.N.stop()};
g.R.Ot=function(){this.B?O8Y(this,this.B):gA(this)};
g.R.y0=function(Q){var W=this;return g.U(function(x){switch(x.B){case 1:if(!W.B){x.kf(2);break}if(W.B.transferState==="TRANSFER_STATE_COMPLETE"||W.B.transferState==="TRANSFER_STATE_FAILED"||!Q.transfer||!Q.transfer.has(W.B.key)){x.kf(3);break}return g.A(x,E8(W.U,W.B.key,"transfer"),4);case 4:W.B=x.U;if(W.B){x.kf(3);break}return g.A(x,EBq(W),3);case 3:if(W.B)return x.return();case 2:return g.A(x,gA(W),0)}})};
g.R.Hl=function(Q,W){var x=this,D,K,l,M,w;return g.U(function(S){switch(S.B){case 1:if(!x.B){eR(x,"onTransferFailure: "+Q);S.kf(2);break}D=x.B;l=((K=D)==null?0:K.key)?g.jd(D.key).entityId:"";a:switch(Q){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var b=!1;break a;default:b=!0}return b&&jrF(x)?g.A(S,fe(x,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.A(S,
M$u(x,Q),5);case 5:if(!l||!x.D){S.kf(2);break}return g.A(S,z9(l,x.D,x.U,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.A(S,yG(x,l),9);case 9:M=S.U;R$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:l,t9:D,offlineModeType:M});if(!l||!x.D){S.kf(2);break}return g.A(S,z9(l,x.D,x.U,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:cz(x),w=gA(x,!0),W&&W(w),g.VF(S)}})};
g.R.Ai=function(Q){var W=this,x,D,K,l,M,w,S,b,z,k,X,u;return g.U(function(Y){switch(Y.B){case 1:if(!W.B){eR(W,"onMaybeTransferStreamsExpired");Y.kf(2);break}return jrF(W)?g.A(Y,fe(W,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.A(Y,M$u(W,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!W.D){Y.kf(2);break}x=W.B;K=((D=x)==null?0:D.key)?g.jd(x.key).entityId:"";if(!K){Y.kf(2);break}return g.A(Y,z9(K,W.D,W.U,"DOWNLOAD_STATE_FAILED"),2);case 9:return W.B||eR(W,"onMaybeTransferStreamsExpiredRetryAttempting"),
l=W.B,w=((M=l)==null?0:M.key)?g.jd(l.key).entityId:"",g.A(Y,yG(W,w),10);case 10:return S=Y.U,R$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:w,t9:l,offlineModeType:S}),b=jvY(),g.cp(b,qV,{isEnqueuedForExpiredStreamUrlRefetch:!0}),z=g.Mb(w,"playbackData"),k={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:z,actionMetadata:b},X=ne(new u_("playbackData",w,k)),g.A(Y,O8(W.U,X,"offlineOrchestrationActionWrapperEntity"),2);case 2:cz(W),u=gA(W,!0),
Q&&Q(u),g.VF(Y)}})};
var bvA={},RQp=(bvA.TRANSFER_STATE_TRANSFERRING=1,bvA.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,bvA);g.R=Zq.prototype;g.R.dU=function(){return this.L.promise};
g.R.pc=function(){if(this.U&&this.G)return this.L.promise;bTs(this).then(this.L.resolve).catch(this.L.reject);return this.L.promise};
g.R.KT=function(Q){var W={};return W.playbackData=new ZZ1(Q,this.bj,this.B),W.transfer=new b8R(Q,this.bj),W.videoPlaybackPositionEntity=new tOu(Q,this.bj),W};
g.R.N1=function(){var Q=this;return g.U(function(W){return Q.U?g.A(W,r2C(Q.U),0):W.kf(0)})};
g.R.FO=function(){var Q=this,W,x;return g.U(function(D){if(D.B==1)return Q.U||Q.G?g.A(D,Q.dU(),2):D.return();Q.S!==void 0&&(g.nl(Q.S),Q.S=void 0);Q.N!==void 0&&(g.nl(Q.N),Q.N=void 0);(W=Q.U)==null||W.dispose();Q.U=void 0;(x=Q.G)==null||x.dispose();Q.G=void 0;Q.api.Wt("onOrchestrationLostLeader");Q.L=new g.XT;g.VF(D)})};
g.R.isOrchestrationLeader=function(){return this.D.B};
g.R.Dg=function(){return g.U(function(Q){return Q.return(!1)})};
g.R.g9=function(Q){var W=this.B;W.api.publish("offlinetransferpause",Q);var x;(x=W.U)==null||x.postMessage(Q)};
g.R.Ot=function(Q){var W,x;return g.U(function(D){if(D.B==1)return g.A(D,t9(),2);W=D.U;if(!W)return D.return();x=g.Mb(Q,"transfer");return g.A(D,Tc(W,{mode:"readwrite",dG:!0},function(K){var l=gU(K,x,"transfer"),M=gU(K,g.Mb(Q,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.CX.all([l,M]).then(function(w){w=g.V(w);var S=w.next().value;var b=w.next().value;return S&&S.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(S.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",fF(K,S,"transfer").then(function(){R$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Q,t9:S,offlineModeType:b==null?void 0:b.offlineModeType});return g.CX.resolve(null)})):g.CX.resolve(null)})}),0)})};
g.R.AZ=function(Q){Q=Q===void 0?43200:Q;var W=this,x,D,K,l,M,w,S,b;return g.U(function(z){if(z.B==1)return W.X.yv()?g.A(z,t9(),2):z.return(srF());if(z.B!=3){x=z.U;if(!x)return z.return([]);D=Date.now()/1E3;return g.A(z,FM(x,"offlineVideoPolicy"),3)}K=z.U;l=[];M=g.V(K);for(w=M.next();!w.done;w=M.next())S=w.value,Number(S.lastUpdatedTimestampSeconds)+Q<=D&&(b=g.jd(S.key).entityId,l.push(b));return l.length?z.return(Le(W,l,W.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):z.return([])})};
g.R.deleteAll=function(){return Le(this,["!*$_ALL_ENTITIES_!*$"],this.T,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.R.refreshAllStaleEntities=function(Q){var W=this;return g.U(function(x){return x.B==1?g.A(x,W.AZ(Q),2):x.return(x.U)})};
g.R.setUpPositionSyncInterval=function(Q){var W=this;this.N!==void 0&&(g.nl(this.N),this.N=void 0);var x=Q!=null?Q:864E5;this.N=g.uY(function(){W.oT(x)},x)};
g.R.oT=function(Q){var W=this,x,D,K,l,M,w;return g.U(function(S){switch(S.B){case 1:return g.P5(S,2),g.A(S,m8.getInstance(),4);case 4:x=S.U;if(!x)throw Error("prefStorage is undefined");return g.A(S,x.get("psi"),5);case 5:D=S.U;l=((K=D)==null?0:K.i5)?Number(D.i5)/1E3:0;M=Date.now();if(!(l+Q<=M)){S.kf(6);break}return g.A(S,Le(W,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Cs(S,0);break;case 2:w=g.Jv(S),Dq("Offline manager error",w),
g.VF(S)}})};
g.R.ya=function(){var Q=this,W,x,D,K,l,M,w;return g.U(function(S){if(S.B==1)return g.A(S,t9(),2);if(S.B!=3)return(W=S.U)?g.A(S,FM(W,"transfer"),3):S.return([]);x=S.U;D=[];K=g.V(x);for(l=K.next();!l.done;l=K.next())M=l.value,M.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&M.key&&(w=g.jd(M.key).entityId,D.push(w));return S.return(kyp(Q,D))})};
g.R.M$=function(){return g.U(function(Q){return Q.return([])})};
g.R.uL=function(){return g.U(function(Q){g.VF(Q)})};
g.R.dS=function(){return g.U(function(Q){g.VF(Q)})};g.n(XgH,AM);XgH.prototype.U=function(Q){return SR(Q)?YI7(this,Q):b_(Q)?V$A(this,Q):s4(Q)?PfF(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var rA=[10];g.n(hQC,AM);hQC.prototype.U=function(Q){return SR(Q)?dhu(this,Q):b_(Q)?iTC(this,Q):s4(Q)?AUF(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var Gy5=[10];g.n(UhA,AM);UhA.prototype.U=function(Q){return b_(Q)?Bks(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};g.n($hH,Zq);g.R=$hH.prototype;g.R.KT=function(Q){var W=Zq.prototype.KT.call(this,Q);W.mainVideoEntity=new hQC(Q,this.bj,this.B);W.mainPlaylistEntity=new XgH(Q,this.bj,this.B);W.mainDownloadsListEntity=new UhA(Q,this.bj,this.B);return W};
g.R.refreshAllStaleEntities=function(Q,W){var x=this,D,K,l,M,w,S,b,z,k,X,u;return g.U(function(Y){switch(Y.B){case 1:D=[];if(!x.bj.j("web_player_offline_playlist_auto_refresh")){Y.kf(2);break}return g.A(Y,IEY(x,Q,W),3);case 3:D=Y.U;case 2:return g.A(Y,m8.getInstance(),4);case 4:return K=Y.U,g.A(Y,(l=K)==null?void 0:l.get("sdois"),5);case 5:return M=Y.U,g.A(Y,(w=K)==null?void 0:w.get("lmqf"),6);case 6:S=Y.U;if(!M){Y.kf(7);break}z=D;k=z.concat;return g.A(Y,mhs(x,M,(b=S)!=null?b:"SD",Q===0),8);case 8:D=
k.call(z,Y.U);case 7:return X=D,u=X.concat,g.A(Y,Zq.prototype.refreshAllStaleEntities.call(x,Q,W),9);case 9:return D=u.call(X,Y.U),Y.return(D)}})};
g.R.Dg=function(Q){var W,x,D,K,l,M,w,S;return g.U(function(b){if(b.B==1)return g.A(b,t9(),2);if(b.B!=3)return(W=b.U)?g.A(b,E8(W,g.UK,"mainDownloadsListEntity"),3):b.return(!1);x=b.U;if((D=x)==null?0:(K=D.downloads)==null?0:K.length)for(l=g.Mb(Q,"mainVideoEntity"),M=g.V(x.downloads),w=M.next();!w.done;w=M.next())if(S=w.value,S.videoItem===l)return b.return(!0);return b.return(!1)})};
g.R.M$=function(){var Q=this,W,x,D,K,l,M,w,S;return g.U(function(b){if(b.B==1)return g.A(b,t9(),2);if(b.B!=3)return(W=b.U)?g.A(b,FM(W,"downloadStatusEntity"),3):b.return([]);x=b.U;D=[];K=g.V(x);for(l=K.next();!l.done;l=K.next())M=l.value,M.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&M.key&&(w=g.jd(M.key).entityId,D.push(w));return D.length?(S={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},b.return(Le(Q,D,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
S))):b.return([])})};
g.R.dS=function(){var Q;return g.U(function(W){return W.B==1?g.A(W,t9(),2):(Q=W.U)?g.A(W,Tc(Q,{mode:"readwrite",dG:!0},function(x){return y6(x,"mainVideoEntity").then(function(D){var K=[];D=g.V(D);for(var l=D.next();!l.done;l=D.next()){l=l.value;var M=void 0;(M=l.userState)!=null&&M.playbackPosition||(M=g.jd(l.key).entityId,M={key:g.Mb(M,"videoPlaybackPositionEntity"),videoId:M,lastPlaybackPositionSeconds:"0"},K.push(fF(x,M,"videoPlaybackPositionEntity")),l.userState={playbackPosition:M.key},K.push(fF(x,
l,"mainVideoEntity")))}return g.CX.all(K)})}),0):W.return()})};
g.R.uL=function(){var Q,W,x,D,K,l,M,w,S,b,z,k,X,u,Y,v,J,h,G,H,I,c,O,T,Ks,Mz,QF,f,t,P,Z,c5,vu,kF,a1,El,D7,uC;return g.U(function(p){if(p.B==1)return g.A(p,t9(),2);if(p.B!=3){Q=p.U;if(!Q)return p.return();W=g.Mb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.A(p,Tc(Q,{mode:"readonly",dG:!0},function(a){return g.CX.all([gU(a,W,"mainDownloadsListEntity"),gU(a,g.UK,"mainDownloadsListEntity"),y6(a,"mainVideoEntity"),y6(a,"mainPlaylistEntity")])}),3)}x=p.U;
D=g.V(x);K=D.next().value;l=D.next().value;M=D.next().value;w=D.next().value;S=K;b=l;z=M;k=w;X=new Set;if((u=S)==null?0:(Y=u.downloads)==null?0:Y.length)for(v=g.V(S.downloads),J=v.next();!J.done;J=v.next())h=J.value,G=void 0,(H=(G=h.videoItem)!=null?G:h.playlistItem)&&X.add(H);if((I=b)==null?0:(c=I.downloads)==null?0:c.length)for(O=g.V(b.downloads),T=O.next();!T.done;T=O.next())Ks=T.value,Ks.videoItem&&X.add(Ks.videoItem);Mz=new Set;QF=[];f=g.V(k);for(t=f.next();!t.done;t=f.next()){P=t.value;if(P.videos)for(Z=
g.V(P.videos),c5=Z.next();!c5.done;c5=Z.next())vu=c5.value,(kF=JSON.parse(g.jd(vu).entityId).videoId)&&Mz.add(kF);P.key&&!X.has(P.key)&&QF.push(P.key)}a1=g.V(z);for(El=a1.next();!El.done;El=a1.next())D7=El.value,D7.key&&!X.has(D7.key)&&(uC=g.jd(D7.key).entityId,Mz.has(uC)||QF.push(D7.key));return QF.length?g.A(p,nk1(Q,QF),0):p.kf(0)})};g.n(NkJ,AM);NkJ.prototype.U=function(Q){return SR(Q)?gRR(this,Q):b_(Q)?yUR(this,Q):s4(Q)?eQA(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var O4=[10];g.n(ZTp,AM);ZTp.prototype.U=function(Q){return SR(Q)?rUC(this,Q):b_(Q)?Tks(this,Q):s4(Q)?OTR(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var E4=[10];g.n(t$R,AM);t$R.prototype.U=function(Q){return SR(Q)?D15(this,Q):b_(Q)?KgC(this,Q):s4(Q)?l9k(this,Q):Promise.reject(Error("Unsupported action type: "+Q.actionType))};
var x1p=[10];g.n(Fg,Zq);Fg.prototype.KT=function(Q){var W=Zq.prototype.KT.call(this,Q);W.musicTrack=new t$R(Q,this.B);W.musicPlaylist=new ZTp(Q,this.B);W.musicAlbumRelease=new NkJ(Q,this.B);return W};
Fg.prototype.refreshAllStaleEntities=function(Q,W){var x=this,D,K,l;return g.U(function(M){if(M.B==1)return g.A(M,MSY(x,Q,W),2);if(M.B!=3)return K=D=M.U,l=K.concat,g.A(M,Zq.prototype.refreshAllStaleEntities.call(x,Q,W),3);D=l.call(K,M.U);return M.return(D)})};g.n(R6C,g.V1);g.R=R6C.prototype;g.R.create=function(){var Q=this;g.y(this,this.events);g.ET(this.bj)?this.B=new $hH(this.bj,this.player):g.Il(this.bj)&&(this.B=new Fg(this.bj,this.player));this.events.W(this.player,"onPlaybackStartExternal",function(){Q.dA()});
this.events.W(this.player,"videodatachange",function(){Q.dA()});
this.bj.j("html5_offline_playback_position_sync")&&this.events.W(this.player,"presentingplayerstatechange",this.Ci)};
g.R.AX=function(){return!1};
g.R.Mw=function(Q,W,x,D){var K=this;return g.U(function(l){return K.B?l.return(Le(K.B,Q,W,x,D)):l.return(Promise.reject())})};
g.R.deleteAll=function(){return this.B.deleteAll()};
g.R.AZ=function(Q){return this.B.AZ(Q)};
g.R.refreshAllStaleEntities=function(Q){return this.B.refreshAllStaleEntities(Q)};
g.R.setUpPositionSyncInterval=function(Q){this.B.setUpPositionSyncInterval(Q)};
g.R.g9=function(Q){this.B.g9(Q)};
g.R.Ot=function(Q){return this.B.Ot(Q)};
g.R.dA=function(){var Q=this,W;return g.U(function(x){W=Q.player.getVideoData();return g.tf(W)?wvH(W)&&Q.U!==W.clientPlaybackNonce?g.A(x,Sb7(Q,W),0):x.kf(0):x.return()})};
g.R.Ci=function(Q){var W=this,x,D,K,l,M,w,S;return g.U(function(b){if(b.B==1)return x=W.player.getVideoData(),D=x.s3,g.XV(Q,2)||g.XV(Q,512)?g.A(b,t9(),2):b.return();if(b.B!=3){K=b.U;if(!K)return Dq("PES is undefined"),b.return();l=x.videoId;return g.A(b,E8(K,g.Mb(l,"mainVideoEntity"),"mainVideoEntity"),3)}M=b.U;if(!M)return b.return();w=Math.floor(D).toString();S={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:w}};return g.A(b,W.Mw([l],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
S),0)})};
g.R.isOrchestrationLeader=function(){return this.B.isOrchestrationLeader()};
g.R.updateDownloadState=function(Q,W){var x,D,K,l;return g.U(function(M){if(M.B==1)return g.A(M,t9(),2);x=M.U;if(!x)return Dq("PES is undefined"),M.return();D=g.jd(Q);K=D.entityType;l=D.entityId;return g.A(M,z9(l,K,x,W,!0),0)})};g.nM("offline",R6C);})(_yt_player);
